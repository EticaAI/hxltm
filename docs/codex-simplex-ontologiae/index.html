<!--
Dominium Publicum
SPDX-License-Identifier: Unlicense
-->
<!doctype html>
<html lang="la">

<head>
  <meta charset="utf-8">
  <title>cōdex simplex ontologiae</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css"
    integrity="sha512-1fPmaHba3v4A7PaUsComSM4TBsrrRGs+/fv0vrzafQ+Rw+siILTiJa0NtFfvGeyY5E182SDTaF5PqP+XOHgJag=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css" integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.css"
    integrity="sha512-CCnciBUnVXwa6IQT9q8EmGcarNit9GdKI5nJnj56B1iu0LuD13Qn/GZ+IUkrZROZaBdutN718NK6mIXdUjZGqg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css"
    integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    /* https://codemirror.net/demo/resize.html */
    .testum .CodeMirror,
    .w-reversum-logicae .CodeMirror,
    .professorem .CodeMirror {
      border: 1px solid #eee;
      height: auto;
    }

    body {
      padding-bottom: 4em;
    }

    /* Color blind palette from here https://davidmathlogic.com/colorblind/#%23648FFF-%23785EF0-%23DC267F-%23FE6100-%23FFB000*/
    .cm-num0 {
      color: #648FFF !important;
    }

    .cm-num1 {
      color: #FFB000 !important;
    }

    .cm-num2 {
      color: #DC267F !important;
    }

    .cm-num3 {
      color: #785EF0 !important;
    }

    .cm-num4 {
      color: #FE6100 !important;
    }
  </style>
</head>
<!--
  @see
  - https://github.com/HXL-CPLP/forum/issues/60
  - https://github.com/SEMICeu/Core-Person-Vocabulary/issues/39

-->

<body>
  <main class="container">
    <h1>Cōdex simplex ontologiae</h1>
    <p>
      <img title="Dominium publicum" alt="Dominium publicum" src="https://i.creativecommons.org/p/zero/1.0/88x31.png"
        class="float-end">
      <small><a href="https://developer.chrome.com/docs/devtools/console/log/"> console.log de web pasco</a> aperire,
        quaeso! <kbd>Control+Shift+J</kbd> aut <kbd>Command+Option+J</kbd>.</small>
    </p>
    <section id="w-scientiam" class="clearfix">
      <h2 id="h-scientiam"><a href="#h-scientiam">§</a> 1. Scientiam</h2>
    </section>
    <section class="ontologia">
      <h3 id="h-ontologia"><a href="#h-ontologia">§</a> 1.1. Ontologia</h3>
      <textarea id="ontologia" class="c-ontologia" style="width:100%;min-height: 10em;">
# Loading...
      </textarea>
      <div class="btn-group float-end" role="group" aria-label="Toolbar Ontologia">
        <button type="button" class="btn btn-success btn-sm" id="ontologia-archivum-yml">
          <i class="bi bi-file-earmark-arrow-down"></i>
          ontologia.yml
        </button>
        <button type="button" class="btn btn-outline-secondary btn-sm" id="ontologia-archivum-json">
          <i class="bi bi-file-earmark-arrow-down"></i>
          ontologia.json
        </button>
        <a target="_blank" href="#" class="btn btn-outline-secondary btn-sm" id="ontologia-ast-online-dot">
          <i class="bi bi-globe"></i>
          ontologia-numerae.gv
        </a>
        <a target="_blank" href="#" class="btn btn-outline-secondary btn-sm" id="ontologia-ast-online-dot-verbosum">
          <i class="bi bi-globe"></i>
          ontologia-verbosum.gv
        </a>
      </div>
    </section>
    <section class="professorem">
      <h3 id="h-professorem"><a href="#h-professorem">§</a> 1.2. Exemplum bonō</h3>
      <!-- <p><mark>Ad como opus</mark></p> -->
      <!-- <p><mark>Ad como opus</mark></p> -->
      <textarea id="professorem">
# Loading...
      </textarea>
      <div class="btn-group float-end" role="group" aria-label="Toolbar Professōrem">
        <a target="_blank" href="#" class="btn btn-outline-secondary btn-sm" id="professorem-ast-online-dot-verbosum">
          <i class="bi bi-globe"></i>
          usum-professori-verbosum.gv
        </a>
      </div>
    </section>

    <hr style="margin-top: 2em; margin-bottom: 2em;">

    <section>
      <h2 id="reversum-logicae">
        <a href="#reversum-logicae">§</a>2. Reversum logicae
      </h2>

      <section class="w-reversum-logicae">
        <h3 id="reversum-logicae-verbum-unico">
          <a href="#reversum-logicae-verbum-unico">§</a> 2.1. Reversum logicae de verbum unico (sine codice)
        </h3>
        <!-- <form class="row g-3 needs-validation" novalidate> -->
        <form class="row g-3 needs-validation">
          <div class="input-group mb-3">
            <!-- <input type="text" class="form-control" id="i_reversum_logicae" placeholder="Exemplum: alternative name" value=""> -->
            <input type="text" class="form-control" id="i_reversum_logicae" placeholder="Exemplum: alternative name"
              value="alternative name" aria-label="terminum simplici" required>
            <!-- <input type="text" class="form-control" placeholder="Recipient's username" aria-label="Recipient's username" aria-describedby="button-addon2"> -->
            <div class="input-group-text">
              <!-- <input class="form-check-input mt-0" type="checkbox" value="" aria-label="Checkbox for following text input"> -->
              <input class="form-check-input mt-0" type="checkbox" id="i_reversum_logicae_strictum" checked>
              <label class="form-check-label" for="i_reversum_logicae_strictum">Strictum</label>
            </div>
            <button class="btn btn-primary" type="submit" id="i_reversum_logicae_actionem">Reversum</button>
          </div>
        </form>
        <section class="w-reversum-logicae-ast">
          <h4 id="reversum-logicae-ast" style="padding-left: 1em;">
            <a href="#reversum-logicae-ast">§</a> 2.1.1. Conjectūrum
          </h4>
          <section>
            <h5 id="h-reversum-logicae-ast" style="padding-left: 2em;">
              <a href="#h-reversum-logicae-ast">§</a> 2.1.1.1 AST in DOT
              <a target="_blank" href="http://www.graphviz.org/doc/info/lang.html"><i class="bi bi-info-circle"></i></a>
              <a target="_blank" href="http://www.graphviz.org/theory/"><i class="bi bi-info-circle"></i></a>
              <sup><mark>Ad como opus</mark></sup>
            </h5>
            <textarea id="i_reversum_logicae_ast" style="width:100%; height: auto;"># Ad como opus</textarea>
          </section>
        </section>
      </section>

      <hr style="margin-top: 1em; margin-bottom: 1em;">

      <section class="testum">
        <h3 id="h-testum"><a href="#h-testum">§</a> 2.2. Reversum logicae de collēctiōnem (singula collectio per lineam)</h3>
        <textarea id="testum"># Loading...
        </textarea>

        <button type="button" class="btn btn-primary actionem" id="actionem" style="width: 100%;">āctiōnem</button>

        <div class="btn-group float-end" role="group" aria-label="Download testum">
          <button type="button" class="btn btn-outline-success btn-sm" id="testum-archivum-csv">
            <i class="bi bi-file-earmark-arrow-down"></i>
            testum.csv
          </button>
        </div>
        <section class="ast">
          <h4 id="h-ast" style="padding-left: 1em;"><a href="#h-ast">§</a> 2.2.1. Conjectūrum</h4>
          <section>
            <h5 id="h-ast-dot" style="padding-left: 2em;">
              <a href="#h-ast-dot">§</a> 2.2.1.1. AST in DOT
              <a target="_blank" href="http://www.graphviz.org/doc/info/lang.html"><i class="bi bi-info-circle"></i></a>
              <a target="_blank" href="http://www.graphviz.org/theory/"><i class="bi bi-info-circle"></i></a>
            </h5>
            <textarea id="testum_dot"
              style="width:100%; min-height: 5em; height: auto;"># requīrātur: āctiōnem</textarea>
            <div class="btn-group float-end" role="group" aria-label="Toolbar AST DOT">
              <button type="button" class="btn btn-outline-success btn-sm float-end" id="testum-ast-archivum-dot">
                <i class="bi bi-file-earmark-arrow-down"></i>
                testum-ast.gv
              </button>
              <a target="_blank" href="#" class="btn btn-success btn-sm float-end" id="testum-ast-online-dot">
                <i class="bi bi-globe"></i>
                GraphvizOnline
              </a>
            </div>
          </section>
        </section>
      </section>

    </section>

    <section class="todo">
      <hr>
      <h2><mark>Ad como opus</mark></h2>
      <ul>
        <!-- http://www.graphviz.org/doc/info/lang.html -->
        <li>http://viz-js.com/
          <!-- http://www.graphviz.org/doc/info/lang.html -->
        </li>
        <li>https://github.com/dagrejs/dagre/wiki</li>
        <li>http://webgraphviz.com/</li>
        <!-- _[eng-Latn] this one accept show via URL [eng-Latn]_  -->
        <li>http://graphviz.it/#/gallery/nhg.gv</li>
        <li>https://dreampuf.github.io/GraphvizOnline/</li>
        <li>https://github.com/magjac/d3-graphviz</li>
        <li>http://magjac.com/graphviz-visual-editor/</li>
        <li>https://dotuml.com/</li>
      </ul>
    </section>
  </main>

  <nav class="navbar navbar-light fixed-bottom" style="background-color: #e3f2fd; border-top: solid #0d6efd;">
    <div class="container-xxl">
      <!-- <a class="navbar-brand" href="#">Fixed bottom</a> -->
      <!-- <form class="d-flex"> -->
      <form class="row">
        <div class="col-3 col-md-4  col-sm-6">
          <input type="text" id="objectivum_linguam" placeholder="objectivum_linguam" value="eng-Latn-150-x-semiceu" />
        </div>
        <div class="col-3 col-md-4 col-sm-6">
          <input type="text" id="auxilium_linguam" placeholder="auxilium_linguam" value="prs-Arab,qhx-Latn,*">
        </div>
        <div class="col-6 col-md-4 col-sm-12">
          <input type="text" id="agendum_linguam" placeholder="agendum_linguam" value="*">
        </div>
        <!-- <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button> -->
      </form>
    </div>
  </nav>
  <!--
    https://data.humdata.org/dataset/countries-and-territories
    https://docs.google.com/spreadsheets/d/1NjSI2LaS3SqbgYc0HdD8oIb7lofGtiHgoKKATCpwVdY/edit#gid=1088874596

    $ /workspace/git/EticaAI/tico-19-hxltm/scripts/fn/linguacodex.py \-\-de_codex eng-Latn-150-x-semiceu | jq
  -->
  <!-- <div class="fixed-bottom" style="background-color: darkgray;">
    <div class="container">
      <div class="btn-toolbar" role="toolbar" aria-label="Toolbar" style="padding: 5px">
        <form>
          <input type="text" id="objectivum_linguam" placeholder="objectivum_linguam" value="eng-Latn-150-x-semiceu" />
          <input type="text" id="auxilium_linguam" placeholder="auxilium_linguam" value="prs-Arab,qhx-Latn,*">
          <input type="text" id="agendum_linguam" placeholder="agendum_linguam" value="*">
          <button type="button" class="btn btn-primary actionem" id="actionem">āctiōnem</button>
        </form>
      </div>
    </div> -->
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"
    integrity="sha512-CSBhVREyzHAjAFfBlIBakjoRUKp5h7VSweP0InR/pAJyptH7peuhCsqAI/snV+TwZmXZqoUklpXp6R6wMnYf5Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/
    const debug = false
    let datum_globum = {}
    let scientia_basi = null // crude ontology.yml, _as it is_
    let scientia_basi_mutatum_est = null // last change on ontology.yml
    let scientia = null // computed result
    let testum = {}
    let usum_professori_tabulam = [] // CSV
    let usum_professori_obiectum = {} // CSV
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/
    // const yaml = require('js-yaml');


    /**
     * _[eng-Latn]
     * From only array of headers and optionally some rows, build an rudimentar
     * abstract syntax tree (without any awareness of what this means)
     * [eng-Latn]_
     *
     * @param   {array} caput_collectionem - JavaScript Array de caput
     * @param   {array} [rem_collectionem] - JavaScript Array[Array] de datum
     * @returns {array}
     */
    function abstractum_syntaxim_arborem(caput_collectionem, rem_collectionem = null) {
      let ast_crudum = []
      let rem_crudum = []
      let coniunctum = new Set()
      let abstractum_nodum = new Set()
      let crudum_abstractum_nodum = []
      let rem_et_codicem = []
      let indicem = 1

      // Tests
      // abstractum_syntaxim_arborem(['Attacker name [12.10.34~1]', '', 'Survivor name [12.10.34~2]', 'Something else', 'Company name [14.56~2]'])

      // 0: [<0:originale_indicem>, <1:originale_caput>, <2:typum_caput>, <3:aliud_caput>, <4:codicem_completum>, <5:codicem_basem>, <6:coniunctum>, <7:relationem>, <8:referens_nomen>]
      // 1: vacuum
      // 2: [...<coniunctum_collectionem>]
      // 3: [...<crudum_abstractum_nodum>]

      let _argumented = []
      let _meta = []

      _argumented.push(null)

      for (const [index, caput] of caput_collectionem.entries()) {
        let adhoc = quod_significationem_de_caput_item(caput)
        coniunctum.add(adhoc[4])
        let lineam = [index + 1, caput].concat(adhoc)
        lineam.push([]) // <relationem>
        lineam.push('') // <referens_nomen>
        _argumented.push(lineam)

        if (adhoc[3]) {
          rem_et_codicem.push([index + 1, adhoc[3]])
          let _parts = adhoc[3].split('.')
          _parts.pop()
          while (_parts.length) {
            if (_parts.length > 0) {
              abstractum_nodum.add(_parts.join('.'))
              _parts.pop()
            }
          }
        }
        // console.log('adhoc[6]', adhoc[4], adhoc)
      }
      let _an = []
      let _etal = []
      if (abstractum_nodum.size) {
        _an = Array.from(abstractum_nodum).sort()
        let aindex = -2
        for (let item of _an) {
          crudum_abstractum_nodum.push(
            [aindex, item, -100, item, item, item, null, [], '']
          )
          aindex = aindex - 1
        }

        let _etal = _argumented.concat(crudum_abstractum_nodum)
        // _etal = _etal.filter()

        // relationem
        for (let [index_1, item_1] of crudum_abstractum_nodum.entries()) {
          // console.log('item0', item_0)
          for (let item_2 of _etal) {
            // console.log('item_1[5]', item_1[5])
            // if (item_2 && item_2[5] && item_2[5].indexOf(item_1 + '.') === 0) {
            if (item_2 && item_2[5] && item_2[5].indexOf(item_1[5] + '.') === 0) {
              // console.log(crudum_abstractum_nodum[index_1])
              let _parts = item_2[5].replace(item_1[5] + '.', '').split('.')
              // console.log('_parts', _parts, item_2[5], item_1[5], item_2[5].replace(item_1[5] + '.', ''), '')
              if (_parts.length === 1) {
                crudum_abstractum_nodum[index_1][7].push(item_2[0])
                // console.log('foi mesmo', index_1, item_2[0])
              }
            }
          }
        }
      }

      _meta.push(
        Array.from(coniunctum).sort()
      )

      ast_crudum.push(_argumented)
      ast_crudum.push(rem_collectionem)
      ast_crudum.push(_meta)
      ast_crudum.push(crudum_abstractum_nodum)

      // console.log('abstractum_syntaxim_arborem_v2', ast)

      return ast_crudum
    }

    // @TODO: implement way to, via curated examples of previously tagged data
    //        add codes on a dataset
    function abstractum_syntaxim_arborem_de_conscientiam(ast_de_professorem, scientia_basi, optionem = {}) {
      // Trivia: https://en.wiktionary.org/wiki/conscientia#Latin
      let ast_finale = ast_de_professorem

      // 0: [<0:originale_indicem>, <1:originale_caput>, <2:typum_caput>, <3:aliud_caput>, <4:codicem_completum>, <5:codicem_basem>, <6:coniunctum>, <7:relationem>, <8:referens_nomen>]
      if (ast_finale[0]) {
        for (let index = 1; index < ast_finale[0].length; index++) {
          if (ast_finale[0][index][5]) {
            let referens_nomen = quod_cognitionem(scientia_basi, { codicem: ast_finale[0][index][5] })
            if (referens_nomen && referens_nomen[0]) {
              ast_finale[0][index][8] = referens_nomen[0]
              // console.log('deu', referens_nomen[0])
            }
          }
        }
      }

      // 3: [...<crudum_abstractum_nodum>]
      if (ast_finale[3]) {
        // index de 0
        for (let index = 0; index < ast_finale[3].length; index++) {
          // <5:codicem_basem>
          // <8:referens_nomen>
          if (ast_finale[3][index][5]) {
            let referens_nomen = quod_cognitionem(scientia_basi, { codicem: ast_finale[3][index][5] })
            if (referens_nomen && referens_nomen[0]) {
              ast_finale[3][index][8] = referens_nomen[0]
              // console.log('deu2', referens_nomen[0])
            }
            // console.log('referens_nomen', referens_nomen)
          }
          // console.log('oi', ast_finale[3][index][5])
        }
      }
      return ast_finale
    }

    // @TODO: implement way to, via curated examples of previously tagged data
    //        add codes on a dataset
    function abstractum_syntaxim_arborem_de_professorem(ast_crudum) {
      let ast_de_professorem = ast_crudum
      return ast_de_professorem
    }

    /**
     * _[eng-Latn] Return subset of variables from it's cluster number [eng-Latn]_
     *
     * @param {array}  rem_completum
     * @param {number} coniunctum
     * @returns {array}
     **/
    function ast_coniunctum(rem_completum, coniunctum) {
      let resultatum = []
      rem_completum.forEach(element => {
        if (element[3] === coniunctum) {
          resultatum.push(element)
        }
      });
      if (resultatum.length === 0) {
        throw `ast_coniunctum non? coniunctum[${coniunctum}] rem_completum [${JSON.stringify(rem_completum)}] `;
      }
      return resultatum
    }

    /**
     * _[eng-Latn] A rudimentar summary of Abstract Syntax Tree. Consider use
     * the ast_in_dot_numerae()
     * [eng-Latn]_
     *
     * @param {array}  ast
     * @returns {object}
     **/
    function ast_in_summarium(ast) {
      let resultatum = {}

      // ast_in_summarium(abstractum_syntaxim_arborem(['12.10.34', '12.10.34~2', '', '14.56', '14.56', '14.56~2']))
      if (ast && ast.length) {
        ast.forEach(coniunctum_et_rem_collectionem => {
          let coniunctum = "" + coniunctum_et_rem_collectionem[0]
          // console.log(coniunctum)
          resultatum[coniunctum] = []
          coniunctum_et_rem_collectionem[1].forEach(rem_collectionem => {
            // console.log('rem_collectionem', rem_collectionem)
            if (Array.isArray(rem_collectionem)) {
              resultatum[coniunctum].push("" + rem_collectionem[0] + ',' + rem_collectionem[1])
            } else {
              resultatum[coniunctum].push('' + rem_collectionem)
            }
          });
        });
      }

      return resultatum
    }

    // document.querySelector('#testum_dot').value = ast_in_dot_numerae(abstractum_syntaxim_arborem(['12.10.34', '12.10.34~2', '', '14.56', '14.56', '14.56~2'])
    // ast_in_dot_numerae(abstractum_syntaxim_arborem(['12.10.34', '12.10.34~2', '', '14.56', '14.56', '14.56~2']))
    // summārium, https://en.wiktionary.org/wiki/summarium
    function ast_in_dot_numerae(ast, titulum) {
      let resultatum = []
      const sumarium = ast_in_summarium(ast)
      // return sumarium

      resultatum.push(`digraph "${titulum}" {`)
      Object.entries(sumarium).forEach(([clavem, rem_simplex]) => {
        console.log(`${clavem} ${rem_simplex}`); // "a 5", "b 7", "c 9"
        // let rem_simplex_q = rem_simplex.reduce(function (acc, val) {
        //   return acc + ` "${val}"`
        // })
        let rem_simplex_q = rem_simplex.map(function (item) {
          return `"${item}"`
        }).join(" ");
        // rem_simplex.forEach(it => {
        //   rem_simplex_q
        // });
        resultatum.push(`  subgraph "cluster_${clavem}" {${rem_simplex_q}}`)
      });
      // resultatum.push('A -> {B C}')
      resultatum.push('}')
      return resultatum.join("\n")
    }

    function ast_in_dot_v2(ast, titulum, annotationem = '') {
      let resultatum = []
      // const sumarium = ast_in_summarium(ast)
      // return sumarium

      let dot = new Graphviz(titulum)

      if (annotationem) {
        dot.addAnnotation(annotationem)
      }

      for (let lineam of ast[3]) {
        if (!lineam) {
          continue
        }

        // Habesne codicem? [00.00]
        // Nom codicem? Indicem (0)
        let label = (lineam[5] ? `[${lineam[5]}]` : `(${lineam[0]})`)

        // <8:referens_nomen>?
        if (lineam[8]) {
          label = label + '\\n' + lineam[8]
        } else {
          label = label + '\\n---'
        }
        // // <3:aliud_caput> ?
        // if (lineam[3]) {
        //   label = label + ' \\n' + lineam[3]
        // } else {
        //   label = label + '\\n---'
        // }

        dot.addNode(`_${lineam[0]}`, { 'cluster': lineam[6], 'rank': __codicem_rank(lineam[5]) }, { 'label': label, style: 'dotted' })
        if (lineam[7]) {
          dot.addRelIndirect(`_${lineam[0]}`, lineam[7].map(x => '_' + x))
        }
      }

      for (let lineam of ast[0]) {
        if (!lineam) {
          continue
        }

        let label = (lineam[5] ? `[${lineam[5]}]` : `(${lineam[0]})`)

        // <8:referens_nomen>?
        if (lineam[8]) {
          label = label + '\\n' + lineam[8]
        } else {
          label = label + '\\n---'
        }
        // <3:aliud_caput> ?
        if (lineam[3]) {
          label = label + ' \\n' + lineam[3]
        } else {
          label = label + '\\n---'
        }

        // dot.addNode(`_${lineam[0]}`, {'cluster': lineam[6]}, { 'label': label })
        dot.addNode(`_${lineam[0]}`, { 'cluster': lineam[6], 'rank': __codicem_rank(lineam[5]) }, { 'label': label })
        // console.log(lineam)
      }
      if (dot.hasCluster('-1')) {
        // console.log('tem')
        dot.addCluster('-1', { 'label': '?' })
      }

      return dot.render()
    }

    /**
     * _[eng-Latn]Convert from tabular format to object format. Mostly used
     * to use example tables already labeled with codes trying to merge
     * everything as if was a planned ontology
     * [eng-Latn]_
     */
    function codex_de_tabulam_in_obiectum(usum_professori_tabulam) {
      let obiectum = {}

      codex = new CodexDeTabulam()

      usum_professori_tabulam.forEach(lineam => {
        // console.log('lineam', lineam)
        let titulum = lineam.shift()
        let linguam = lineam.shift()
        // console.log('lineam', lineam)

        while (lineam.length > 0) {
          let sig = null
          if (lineam[0]) {
            sig = quod_significationem_de_caput_item(lineam[0])
            // console.log('sig', sig)
            if (sig[3]) {
              // console.log('foi', sig)
              codex.addereRem(sig[3], linguam, sig[1])
            }
          }
          lineam.shift()
        }
      });

      // quod_significationem_de_caput_item()

      codex.praeparare()

      // console.log('codex resultatum', codex.resultatum())

      // return usum_professori_tabulam
      return codex.resultatum()
    }

    class CodexBasim {
      constructor() {
        this.datum_de_factum = {};
        this.datum_reconstructum = {};

        // @TODO: convert languages to new Set()
        this.objectivum_linguam = [];
        this.auxilium_linguam = [];
        this.agendum_linguam = ['*']; // All languages are working languages
        // objectivum_linguam = null, agendum_linguam = []
        // Trivia: ignārum, https://en.wiktionary.org/wiki/ignarus#Latin
        this.ignarum_linguam = new Set()
      }

      _adNormale(terminum) {
        let normale = ''
        if (!terminum || terminum.length === 0) {
          return 'errorem'
        }
        normale = terminum.trim().toLowerCase().normalize("NFC")
        return normale
      }

      _estHocLinguamAgendae(linguam) {
        if (this.agendum_linguam.indexOf('*') > -1) {
          return true
        }
        if (this.objectivum_linguam.indexOf(linguam) > -1) {
          return true
        }
        if (this.auxilium_linguam.indexOf(linguam) > -1) {
          return true
        }
        return false
      }

      /**
       * Est hoc linguam objectivae aut linguam auxilio?
       **/
      _estHocLinguamAuxilio(linguam, strictum = true) {
        if (!strictum && this.auxilium_linguam.indexOf('*') > -1) {
          return true
        }
        if (this.auxilium_linguam.indexOf(linguam) > -1) {
          return true
        }
        return false
      }

      /**
       * Est hoc linguam objectivae aut linguam auxilio?
       **/
      _estHocLinguamObjectivae(linguam, strictum = true) {
        // console.log('_estHocLinguamObjectivae', linguam)
        if (!strictum && this.objectivum_linguam.indexOf('*') > -1) {
          return true
        }
        if (this.objectivum_linguam.indexOf(linguam) > -1) {
          return true
        }
        return false
      }

      /**
       * Quod linguam ideae?
       *
       * @param {array} linguam_collectionem
       * @param {bool} multilinguae
       * @returns {array} codicem collēctiōnem
       */
      _quodLinguamIdeae(linguam_collectionem, multilinguae = false) {
        let _temp_obj = []
        let _temp_age = []

        if (multilinguae && (this._estHocLinguamObjectivae('', false) || this._estHocLinguamAuxilio('', false))) {
          return linguam_collectionem
        }

        console.log('linguam_collectionem', linguam_collectionem, multilinguae)
        for (let item of linguam_collectionem) {
          if (this._estHocLinguamObjectivae(item)) {
            _temp_obj.push(item)
          }
          if (this._estHocLinguamAuxilio(item)) {
            _temp_age.push(item)
          }
          console.log('_temp_obj, _temp_age', _temp_obj, _temp_age)
          // @TODO: implement preference by longer language codes with x-private
          // @TODO: implement order user defined on interface
          if (!multilinguae) {
            if (_temp_obj.length > 0) {
              return [_temp_obj[0]]
            }
            if (_temp_age.length > 0) {
              return [_temp_age[0]]
            }
          } else if (_temp_obj.length > 0 || _temp_age.length > 0) {
            return [..._temp_obj, ..._temp_age]
          }
        }
        // console.log('_temp_obj, _temp_age', _temp_obj, _temp_age)
        // console.log('this.objectivum_linguam', this.objectivum_linguam.indexOf('eng-Latn'))
        // console.log('this.objectivum_linguam', this.objectivum_linguam.indexOf('eng-Latn') > -1)
        if (this._estHocLinguamObjectivae('', false) || this._estHocLinguamAuxilio('', false)) {
          return [linguam_collectionem[0]]
        }
        return false
      }

      _quodLinguamPartem(linguam_bcp47) {
        // TODO: port bcp47_langtag from linguacodex.py to javascript
        let resultatum = []
        let adhoc = linguam_bcp47.replace('_', '-')
        resultatum.push(adhoc)

        if (adhoc.indexOf('-x-') > -1) {
          let _temp = adhoc.split('-x-')
          resultatum.push(_temp[0])
          adhoc = adhoc.replace('-x-' + _temp[0], '')
        }
        let _temp2 = adhoc.split('-')
        while (_temp2.length > 0) {
          resultatum.push(_temp2.join('-'))
          _temp2.pop()
        }
        return resultatum
      }

      /**
       * _[eng-Latn] Return all parent codes from a code[eng-Latn]_
       *
       * @param {string} codicem_radix
       * @returns {array} codicem collēctiōnem
       */
      _parentem(codicem_radix) {
        let resultatum = []
        let temp = codicem_radix.split('.')
        temp.pop()
        while (temp.length) {
          resultatum.push(temp.join('.'))
          temp.pop()
        }
        return resultatum
      }

      /**
       * Trivia: agendae, https://en.wiktionary.org/wiki/agendus#Latin
       **/
      estLinguamAgendae(agendum_linguam = []) {
        this.agendum_linguam = []
        for (let item of agendum_linguam) {
          this.agendum_linguam.push(...this._quodLinguamPartem(item))
        }
        return this
      }

      /**
       * Trivia: auxiliō, https://en.wiktionary.org/wiki/auxilium
       **/
      estLinguamAuxilio(auxilium_linguam = []) {
        this.auxilium_linguam = []
        for (let item of auxilium_linguam) {
          this.auxilium_linguam.push(...this._quodLinguamPartem(item))
        }
        return this
      }

      /**
       * Trivia: objectīvae, https://en.wiktionary.org/wiki/auxilium
       **/
      estLinguamObjectivae(objectivum_linguam) {
        this.objectivum_linguam = objectivum_linguam
        this.objectivum_linguam = []
        for (let item of objectivum_linguam) {
          this.objectivum_linguam.push(...this._quodLinguamPartem(item))
        }
        return this
      }

      /**
        * _[eng-Latn]Add manually one item to the base[eng-Latn]_
        *
        * @param {string} codicem_basim
        * @param {string} [linguam]
        * @param {string} [terminum]
        * @returns {object} this
        */
      addereRem(codicem_basim, linguam = 'und-Zyyy', terminum = '') {
        if (!this.datum_de_factum[codicem_basim]) {
          this.datum_de_factum[codicem_basim] = {}
        }
        if (this._estHocLinguamAgendae(linguam)) {
          if (!this.datum_de_factum[codicem_basim][linguam]) {
            this.datum_de_factum[codicem_basim][linguam] = {}
          }
          if (terminum) {
            let _itemnum = 0
            while (this.datum_de_factum[codicem_basim][linguam][`${_itemnum.toString()}`]) {
              _itemnum = _itemnum + 1
            }
            this.datum_de_factum[codicem_basim][linguam][`${_itemnum.toString()}`] = terminum
          }
        } else {
          this.ignarum_linguam.add(linguam)
        }

        return this
      }

      /**
       * _[eng-Latn]Rebuild internal object before be able to be usable[eng-Latn]_
       * @returns {object} this
       */
      praeparare() {
        // console.log('praeparare')
        let non_clavem = new Set()
        let est_clavem = []
        let praefectum = []
        for (let clavem of Object.keys(this.datum_de_factum)) {
          est_clavem.push(clavem)
          let parentem = this._parentem(clavem)
          for (let item of parentem) {
            if (!this.datum_de_factum[item]) {
              non_clavem.add(item)
            }
          }
        }
        praefectum = [...est_clavem, ...non_clavem].sort()
        // console.log('est_clavem', est_clavem)
        // console.log('non_clavem', non_clavem)
        // console.log('praefectum', praefectum)
        for (let item of praefectum) {
          if (!this.datum_de_factum[item]) {
            this.datum_reconstructum[item] = {}
          } else {
            this.datum_reconstructum[item] = this.datum_de_factum[item]
          }
        }
        console.log('this.datum_reconstructum', this.datum_reconstructum)
        return this
      }

      quod_completum() {
        return this.datum_reconstructum
      }

      quod_conceptum(codicem_basim) {
        if (this.datum_reconstructum[codicem_basim]) {
          return this.datum_reconstructum[codicem_basim]
        }
        return false
      }

      quod_terminum(codicem_basim, multilinguae = false) {
        // quod_linguam
        let terminum = []
        let conceptum = this.quod_conceptum(codicem_basim)
        if (!conceptum) {
          return false
        }
        let linguam_collectionem = Object.keys(conceptum)
        let linguam_ideae = this._quodLinguamIdeae(linguam_collectionem, multilinguae)
        // console.log('linguam_ideae', linguam_ideae)
        if (!linguam_ideae) {
          return null
        }
        for (let linguam_ideae_item of linguam_ideae) {
          for (let [index, terminum_item] of Object.entries(conceptum[linguam_ideae_item])) {
            terminum.push([terminum_item, linguam_ideae_item, index])
          }
        }

        return terminum
      }

      reversumLogicae(terminum, linguam_collectionem) {
        this.datum_reconstructum
        let resultatum = []
        let terminum_normali = this._adNormale(terminum)
        for (let [codicem, conceptum_significatini] of Object.entries(this.datum_reconstructum)) {
          // console.log('reversumLogicae', codicem, conceptum_significatini)
          if (conceptum_significatini) {
            for (let [linguam, terminum_collectionem] of Object.entries(conceptum_significatini)) {
              // console.log('reversumLogicae linguam, terminum', linguam, terminum_normali, terminum_collectionem)
              for (let [terminum_indicem, terminum_referens] of Object.entries(terminum_collectionem)) {
                console.log('reversumLogicae terminum_normali, this._adNormale(terminum_referens)', terminum_normali, this._adNormale(terminum_referens))
                if (terminum_normali == this._adNormale(terminum_referens)) {
                  resultatum.push([codicem, linguam, terminum_referens])
                }
              }
            }
          }
          // terminum.push([terminum_item, linguam_ideae_item, index])
        }
        return resultatum
      }
    }

    /**
scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
scientia = new CodexDeObiectum(scientia_basi)
scientia.estLinguamObjectivae(document.querySelector('#objectivum_linguam').value.split(','))
scientia.estLinguamAuxilio(document.querySelector('#auxilium_linguam').value.split(','))
scientia.estLinguamAgendae(document.querySelector('#agendum_linguam').value.split(','))
scientia.praeparare()
scientia.quod_terminum('12')
// scientia.reversumLogicae('alternative name')
    */
    class CodexDeObiectum extends CodexBasim {
      constructor(datum_de_factum) {
        super();
        this.datum_de_factum = datum_de_factum;
        this.datum_reconstructum = {};
      }
      // praeparare() {
      //   // console.log('this.datum_reconstructum', this.datum_reconstructum)
      //   this.datum_reconstructum = this.datum_de_factum
      //   return this
      // }
      quod_de_factum() {
        return this.datum_de_factum
      }

    }

    class CodexDeTabulam extends CodexBasim {
      constructor(datum_de_factum = {}) {
        super();
        this.datum_de_factum = datum_de_factum;
        this.datum_reconstructum = {};
      }

      resultatum() {
        return this.datum_reconstructum
      }
    }

    // CoreMirrorTestumDot.setValue(ast_in_dot_v2(abstractum_syntaxim_arborem(['Attacker name [12.10.34~1]', '', 'Survivor name [12.10.34~2]', 'Something else', 'Company name [14.56~2]']), 'title'))
    class Graphviz {
      constructor(title, type = "strict graph", options = {}) {
        this.title = title;
        this.type = type;
        this.options = options;
        this.clusters = {}
        this.nodes = {}
        this.ranks = {}
        this.reldirect = {}
        this.relindirect = {}
        this.annotations = []
      }

      addAnnotation(annotation) {
        this.annotations.push(annotation)
        return this
      }

      addCluster(cluster_id, options = {}) {
        let _cluster = {
          'id': cluster_id,
          'options': options || {}
        }
        this.clusters[cluster_id] = _cluster
        return this
      }

      // addNode(node_id, cluster = null, options = {}) {
      addNode(node_id, meta = {}, options = {}) {
        let _node = {
          'id': node_id,
          'cluster': (meta && meta.cluster ? meta.cluster : null),
          'options': options || {},
          'rank': (meta && meta.rank ? meta.rank : null),
          'verbose': (meta && meta.verbose ? meta.verbose : null)
        }
        this.nodes[node_id] = _node

        if (meta && meta.cluster && !this.clusters[meta.cluster.toString()]) {
          this.addCluster(meta.cluster)

          // Only try add rank for non clusterized (this seems to disable cluster view)
        } else if (meta && meta.rank) {
          if (!this.ranks[meta.rank.toString()]) {
            this.ranks[meta.rank.toString()] = new Set()
          }
          this.ranks[meta.rank.toString()].add(node_id)
        }
        return this
      }

      addRelDirect(source_id, target_ids) {
        if (!this.type.indexOf('digraph') > -1) {
          throw "Graphviz: addRelDirect != type digraph [" + this.type + ']'
        }
        source_id = source_id.toString()
        if (!this.reldirect[source_id]) {
          this.reldirect[source_id] = new Set()
        }
        // this.reldirect[source_id] = this.reldirect[source_id].concat(target_ids)
        target_ids.forEach(item => this.reldirect[source_id].add(item))
        return this
      }

      addRelIndirect(source_id, target_ids = []) {
        if (this.type.indexOf('digraph') > -1) {
          throw "Graphviz: addRelIndirect != type digraph. [" + this.type + ']'
        }
        source_id = source_id.toString()
        if (!this.relindirect[source_id]) {
          this.relindirect[source_id] = new Set()
        }
        // target_ids.forEach(this.relindirect[source_id].add, target)
        target_ids.forEach(item => this.relindirect[source_id].add(item))
        // console.log('addRelIndirect', source_id, target_ids, this.relindirect)
        // this.relindirect[source_id] = this.relindirect[source_id].concat(target_ids)
        return this
      }

      hasCluster(cluster_id) {
        let keys = Object.keys(this.clusters)
        console.log('hasCluster', cluster_id)
        return keys.includes(cluster_id)
      }

      render() {
        let result = []
        let _q = this._q

        if (this.annotations.length) {
          for (let annotation of this.annotations) {
            result.push('# ' + annotation)
          }
          result.push('')
        }

        result.push(`${this.type} ${this._q(this.title)} {`)
        if (this.options && Object.keys(this.options).length !== 0) {
          if (this.options.node) {
            result.push(`  node [${this._renderOptions(this.options.node)}]`)
          }
          // result.push(`  ${this._renderOptions(this.options)}`)
        }

        for (let [key, value] of Object.entries(this.nodes)) {
          if (!value.cluster) {
            let __verbose = ''
            if (value.verbose && value.verbose.length > 0) {
              let __varr = []
              value.verbose.forEach(item => {
                __varr.push(_q(item))
              });
              __verbose = ' -- {node [shape=none style=""] ' + __varr.join(' ') + '}'
            }

            if (value.options && Object.keys(value.options).length !== 0) {
              result.push(`  ${this._q(value.id)} [${this._renderOptions(value.options)}]${__verbose}`)
            } else {
              result.push(`  ${this._q(value.id)}${__verbose}`)
            }
          }
        }
        for (let [key, value] of Object.entries(this.clusters)) {
          result.push(this._renderCluster(key))
        }
        result.push(this._renderRels())
        result.push(this._renderRanks())

        result.push('}')
        return result.join("\n")
      }

      _renderCluster(cluster) {
        let result = []
        result.push(`  subgraph "cluster_${cluster}" {`)
        if (this.clusters[cluster.toString()].options && Object.keys(this.clusters[cluster.toString()].options).length !== 0) {
          result.push(`    ${this._renderOptions(this.clusters[cluster.toString()].options)}`)
        }

        for (let [key, value] of Object.entries(this.nodes)) {
          if (value.cluster && value.cluster.toString() === cluster.toString()) {
            if (value.options && Object.keys(value.options).length !== 0) {
              result.push(`    ${this._q(value.id)} [${this._renderOptions(value.options)}]`)
            } else {
              result.push(`    ${this._q(value.id)}`)
            }
          }
        }

        result.push('  }')
        return result.join("\n")
      }

      _renderOptions(options) {
        let result = []
        for (let [key, value] of Object.entries(options)) {
          result.push(`${key}="${value}"`)
        }
        return result.join(' ')
      }

      // https://stackoverflow.com/questions/25734244/how-do-i-place-nodes-on-the-same-level-in-dot
      _renderRanks() {
        let result = []
        let _q = this._q
        for (let [key, value] of Object.entries(this.ranks)) {
          if (value.size > 1) {
            let temp = [...value].map(function (item) {
              return _q(item)
            }).join(" ");
            result.push(`  { rank=same ${temp} }`)
          } else {
            // No sense in rank only one item
            // result.push(`  ${_q(key)} -> ${_q([...value][0])}`)
          }
        }
        if (result.length > 0) {
          result.unshift('  newrank=true;')
        }
        return result.join("\n")
      }

      _renderRels() {
        let result = []
        let _q = this._q
        for (let [key, value] of Object.entries(this.reldirect)) {
          if (value.size > 1) {
            let temp = [...value].map(function (item) {
              return _q(item)
            }).join(" ");
            result.push(`  ${_q(key)} -> { ${temp} }`)
          } else {
            result.push(`  ${_q(key)} -> ${_q([...value][0])}`)
          }
        }
        for (let [key, value] of Object.entries(this.relindirect)) {
          // console.log('oi', value)
          if (value.size > 1) {
            let temp = [...value].map(function (item) {
              return _q(item)
            }).join(" ");
            result.push(`  ${_q(key)} -- { ${temp} }`)
          } else {
            result.push(`  ${_q(key)} -- ${_q([...value][0])}`)
          }
        }
        return result.join("\n")
      }

      _q(item) {
        // if (/^[\p{General_Category=Letter}].*$/i.test(item)) {
        //   return item
        // }
        return `"${item}"`
      }
    }

    /**
     * 
     * @example
     *
     * quod_cognitionem(scientia_basi, {codicem:'12'})
     **/
    function quod_cognitionem(scientia_basi, optionem = {}) {
      // codicem, objectivum_linguam, agendum_linguam, terminum_indicem
      if (!scientia_basi || !optionem || !optionem.codicem || !scientia_basi[optionem.codicem]) {
        return false
      }
      let terminum_indicem = optionem.terminum_indicem || "0"
      let clavem_optionem = Object.keys(scientia_basi[optionem.codicem])
      let clavem = quod_linguam(clavem_optionem, optionem.objectivum_linguam, optionem.agendum_linguam)
      // console.log(clavem)

      if (!scientia_basi[optionem.codicem][clavem][terminum_indicem]) {
        return false
      }
      // [<0:referens_nomen>, <1:linguam>, <2:terminum_indicem>]
      return [scientia_basi[optionem.codicem][clavem][terminum_indicem], clavem, terminum_indicem]
    }

    function quod_linguam(optionem = [], objectivum_linguam = null, agendum_linguam = []) {
      // @TODO create javascript version of bcp47_langtag
      //       https://github.com/EticaAI/tico-19-hxltm/blob/main/scripts/fn/linguacodex.py#L1064
      let aliquid = false
      if (!objectivum_linguam || !agendum_linguam) {
        return optionem[0]
      }
      if (objectivum_linguam) {
        for (let opt of optionem) {
          if (opt.toLowerCase() == objectivum_linguam) {
            return opt
          }
        }
      } else if (agendum_linguam) {
        for (agendum in agendum_linguam) {
          if (agendum === '*') {
            aliquid = true
          }
          for (let opt of optionem) {
            if (opt.toLowerCase() == agendum) {
              return opt
            }
          }
        }
      }
      if (aliquid) {
        return optionem[0]
      }

      return false
    }


    /**
     * Trivia:
     * - significātiōnem, https://en.wiktionary.org/wiki/significatio#Latin
     * - pūrum, https://en.wiktionary.org/wiki/purus#Latin
     * - abstractum, https://en.wiktionary.org/wiki/purus#Latin
     *
     * @example
     * // returns [3, '12.34~3', '12.34', 3]
     * quod_significationem_de_codicem_purum('12.34~2', 3)
     *
     * @example
     * // returns [3, '12.34~3', '12.34', 3]
     * quod_significationem_de_codicem_purum('12.34', 4)
     *
     * @example
     * // returns [3, '12.34.56~3', '12.34.56', 3, ['12', '12.34']]
     * quod_significationem_de_codicem_purum('12', -1, true)
     *
     * @param {string} [codicem_purum]
     * @param {number} indicem
     * @param {bool} [abstractum]
     * @returns {array}
     */
    const quod_significationem_de_codicem_purum = (codicem_purum, indicem, abstractum) => {
      // coniunctum = 0: De anglicum "Broadcast address"
      // @see https://en.wikipedia.org/wiki/Broadcast_address
      let coniunctum = 0
      let codicem_completum = codicem_purum
      let codicem_radicem = ''
      let patrem = []

      if (!codicem_purum) {
        throw "codicem_purum?";
      }

      if (codicem_purum.length < 5 && !abstractum) {
        throw `codicem_purum > [00.00]? [${codicem_purum}]`;
      }
      // @TODO: check if starts and ends with digit

      if (codicem_purum.indexOf("~") > -1) {
        let temp = codicem_purum.split("~")
        codicem_radicem = temp[0]
        coniunctum = parseInt(temp[1])
      } else {
        codicem_radicem = codicem_purum
      }
      let temp_parts = codicem_radicem.split('.')
      if (temp_parts.length > 1) {
        // let temp_patrem = codicem_radicem.split('.')
        do {
          // console.log('oi', temp_parts)
          temp_parts.pop();
          patrem.push(temp_parts.join('.'))
        } while (temp_parts.length > 0);

        patrem = patrem.filter(col => col != "").reverse()
      }

      return [indicem, codicem_completum, codicem_radicem, coniunctum, patrem]
    }

    /**
     * Trivia:
     * - significātiōnem, https://en.wiktionary.org/wiki/significatio#Latin
     * - cōdicem, https://en.wiktionary.org/wiki/codex#Latin
     * - aliud, https://en.wiktionary.org/wiki/alius#Latin
     * - typum, https://en.wiktionary.org/wiki/typus#Latin
     * - fontem, https://en.wiktionary.org/wiki/fons#Latin
     *
     * @example <caption>00.00~0</caption>
     * // returns [1, '12.34~5', '', '12.34~5']
     * quod_significationem_de_caput_item('12.34~5')
     *
     * @example <caption>[00.00~0]</caption>
     * // returns [2, '12.34~5', '', '[12.34~5]
     * quod_significationem_de_caput_item('[12.34~5]')
     *
     * @example <caption>[00.00~0] 00=(...); []=(...);</caption>
     * // returns [2, '12.34~5', '', '﹇١٢.٣٤~٥﹈']
     * quod_significationem_de_caput_item('﹇١٢.٣٤~٥﹈')
     *
     * @example
     * // returns [3, '12.34', '//نام جایگزین//', '[12.34] //نام جایگزین//']
     * quod_significationem_de_caput_item('[12.34] //نام جایگزین//')
     *
     * @example
     * // returns @TODO
     * quod_significationem_de_caput_item('alternative-name--12-34')
     *
     * @example
     * // returns @TODO
     * quod_significationem_de_caput_item('备用名称_12-34')
     *
     * @param {string} [textum]
     * @returns {array}
     */
    const quod_significationem_de_caput_item = (textum) => {
      let typum = -1 // -1: non-codicem; 1: numerum purum; 2 [00.00];
      let aliud = ''
      let codicem_completum = ''
      let codicem_radicem = ''
      let codicem_coniunctum = -1
      // let fontem = textum

      // Full test
      // ['12.34~5', '١٢.٣٥', '[12.34~5]', '[12.34~5] lorem ipsum', ' Lorem Ipsum [12.34~5]', '[١٢.٣٥] لوريم إيبسوم', 'lorem-ipsum_12-34', 'lorem-ipsum--12-34'].map(quod_significationem_de_caput_item)

      // @see https://www.unicode.org/reports/tr44/#General_Category_Values
      // Regula cor: 00.00~0
      const RegulaCodicemPurum = `(\\p{General_Category=Decimal_Number}[\\p{General_Category=Decimal_Number}|\.|~]*\\p{General_Category=Decimal_Number})`
      // Regula cor: [00.00~0]
      const RegulaCodicemInVasum = `(\\p{General_Category=Open_Punctuation}${RegulaCodicemPurum}\\p{General_Category=Close_Punctuation})`

      // Regula de factum: /^00.00~0$/
      const __RegulaCodicemPurum = new RegExp('^' + RegulaCodicemPurum + '$', 'u')
      // Regula de factum: /^[00.00~0]$/
      const __RegulaCodicemPurumInVasum = new RegExp('^' + RegulaCodicemInVasum + '$', 'u')
      // Regula de factum: /^[00.00~0] aliud $/
      const __RegulaCodicemPurumInVasumInitiale = new RegExp('^' + RegulaCodicemInVasum + '(.+)$', 'u')
      // Regula de factum: /^ aliud [00.00~0]$/
      const __RegulaCodicemPurumInVasumFinale = new RegExp('^(.+)' + RegulaCodicemInVasum + '$', 'u')

      // Punctuation, connector, 	Includes "_" underscore
      // https://www.compart.com/en/unicode/category/Pc
      //
      // Punctuation, dash, 	Includes "-" dash
      // https://www.compart.com/en/unicode/category/Pd
      //
      // Punctuation, open [, {, ﹇
      // https://www.compart.com/en/unicode/category/Ps
      //
      // Punctuation, close ], }, ﹈
      // https://www.compart.com/en/unicode/category/Pe
      //
      // Punctuation, other . , * ! ?
      // https://www.compart.com/en/unicode/category/Po
      // 
      // Math Symbol

      if (__RegulaCodicemPurum.test(textum)) {
        typum = 1
        codicem_completum = quod_significationem_in_digitum(textum.match(__RegulaCodicemPurum)[0])
        // resultatum.push(textum.match(RegulaCodicemPurum))

      } else if (__RegulaCodicemPurumInVasum.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasum)
        typum = 2
        codicem_completum = quod_significationem_in_digitum(temp[2])

      } else if (__RegulaCodicemPurumInVasumInitiale.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasumInitiale)
        typum = 3
        codicem_completum = quod_significationem_in_digitum(temp[2])
        aliud = temp[3].trim()

      } else if (__RegulaCodicemPurumInVasumFinale.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasumFinale)
        typum = 4
        codicem_completum = quod_significationem_in_digitum(temp[3])
        aliud = temp[1].trim()

      } else {
        // @TODO: implement parsing pattterns like these
        //        - alternative-name--12-34
        //        - altrrnative-nane_12-34
        //        - 备用名称--12-34
        //        - மாற்று பெயர்--12-34
      }
      if (codicem_completum.length > 0) {
        if (codicem_completum.indexOf("~") > -1) {
          let temp = codicem_completum.split("~")
          codicem_radicem = temp[0]
          codicem_coniunctum = parseInt(temp[1])
        } else {
          // console.log('codicem_completum.length', codicem_completum.length, codicem_completum)
          codicem_radicem = codicem_completum
          codicem_coniunctum = 0
        }
      }
      if (codicem_coniunctum === -1) {
        aliud = textum
      }

      // console.log([typum, aliud, codicem_completum, codicem_radicem, codicem_coniunctum])
      return [typum, aliud, codicem_completum, codicem_radicem, codicem_coniunctum]
    }

    // quod_significationem_in_digitum('١٢.٣٥')
    /**
     * @see This comment https://github.com/HXL-CPLP/forum/issues/60#issuecomment-997185201
     */
    function quod_significationem_in_digitum(codicem_purum, in_indicem = 0) {
      if (!codicem_purum || codicem_purum.length === 0) {
        return ''
      }
      let resultatum = ''
      for (const [index, rem] of codicem_purum.split('').entries()) {
        resultatum = resultatum + quod_significationem_in_digitum_de_atomum(rem)
      }
      return resultatum
    }

    // quod_significationem_in_digitum_de_atomum('١')
    /**
     */
    function quod_significationem_in_digitum_de_atomum(atom) {
      const datum = [
        '0123456789', // DIGIT ZERO (...) DIGIT NINE
        '٠١٢٣٤٥٦٧٨٩', // 	ARABIC-INDIC DIGIT ZERO (...) ARABIC-INDIC DIGIT NINE
        '߀߁߂߃߄߅߆߇߈߉', // 	U+07C0	NKO DIGIT ZERO (...) U+07C9	NKO DIGIT NINE
        '०१२३४५६७८९', // U+0966	DEVANAGARI DIGIT ZERO (...) U+096F	DEVANAGARI DIGIT NINE
        // @TODO: This function is obviously partial. Eventually It needs a better alternative.
        //        See this comment
        //        https://github.com/HXL-CPLP/forum/issues/60#issuecomment-997185201
      ]
      // https://www.fileformat.info/info/unicode/category/Nd/list.htm

      for (let NumerumSystema of datum) {
        // console.log('NumerumSystema', NumerumSystema)
        for (const [index, rem] of NumerumSystema.split('').entries()) {
          if (atom === rem) {
            return index
          }
        }
      }
      // _[eng-Latn]Worst case: we return the item, without changes[eng-Latn]_
      return atom
    }

    /**
     * _[eng-Latn]
     * (Debug) what does this text means into Unicode General Category Property
     * (using JavaScript Engine) regexes?
     * [eng-Latn]_
     *
     * @see https://www.unicode.org/reports/tr44/#General_Category_Values
     * @see https://unicode.org/reports/tr18/#General_Category_Property
     * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Unicode_Property_Escapes
     *
     * @example
     * ['12.34~5', '١٢.٣٥', '[12.34~5]', '[12.34~5] lorem ipsum', ' Lorem Ipsum [12.34~5]', '[١٢.٣٥] لوريم إيبسوم', 'lorem-ipsum_12-34', 'lorem-ipsum--12-34'].map(quod_significationem_in_regula)
     *
     * @param {string} textum
     * @returns {array}
     */
    function quod_significationem_in_regula(textum) {
      let resultatum = []
      const RegulaSystemaScribo = /\p{General_Category=Letter}/gu
      const RegulaNumerum = /\p{General_Category=Number}/gu
      const RegulaNumerumDigitum = /\p{General_Category=Decimal_Number}/gu
      const RegulaPunctumInitiale = /\p{General_Category=Open_Punctuation}/gu
      const RegulaPunctumFinale = /\p{General_Category=Close_Punctuation}/gu
      const RegulaSublineam = /\p{General_Category=Connector_Punctuation}/gu
      // @TODO: Non-latinum terminum? https://en.wiktionary.org/wiki/hyphen
      const RegulaHuphen = /\p{General_Category=Dash_Punctuation}/gu
      const RegulaExtrapunctum = /\p{General_Category=Other_Punctuation}/gu
      const RegulaSymbolum = /\p{General_Category=Symbol}/gu
      const RegulaMathematicam = /\p{General_Category=Math_Symbol}/gu

      // // FULL STOP U+002E https://www.compart.com/en/unicode/U+002E
      // const SignificationemSeparatum = '.'
      // // TILDE (U+007E) https://www.compart.com/en/unicode/charsets/containing/U+007E
      // const SignificationemConiunctum = '~'

      // Strict regex
      // const RegulaCodicemPurum = /^(\p{General_Category=Decimal_Number}[\p{General_Category=Decimal_Number}|\.|~]*\p{General_Category=Decimal_Number})$/u
      // const oi = /^(p{General_Category=Decimal_Number}[p{General_Category=Decimal_Number}|.|~]*p{General_Category=Decimal_Number})$/
      // const oi = /^(\p{General_Category=Decimal_Number}[\p{General_Category=Decimal_Number}|\.|~]*\p{General_Category=Decimal_Number})$/
      const RegulaCodicemPurum = `(\\p{General_Category=Decimal_Number}[\\p{General_Category=Decimal_Number}|\.|~]*\\p{General_Category=Decimal_Number})`
      const RegulaCodicemInVasum = `(\\p{General_Category=Open_Punctuation}${RegulaCodicemPurum}\\p{General_Category=Close_Punctuation})`
      // const RegulaCodicemInVasum = /^(\p{General_Category=Decimal_Number}[\p{General_Category=Decimal_Number}|\.|~]*\p{General_Category=Decimal_Number})$/u

      const RegulaInitiale = /^\p{General_Category=Open_Punctuation}(.*)\p{General_Category=Close_Punctuation}.?/u
      const RegulaFinale = /.?\p{General_Category=Open_Punctuation}(.*)\p{General_Category=Close_Punctuation}$/u
      // const RegulaNumerumInitialeEtFinale = /^\p{General_Category=Decimal_Number}([\p{General_Category=Decimal_Number}|\.|~]*)\p{General_Category=Decimal_Number}$/u

      textum = textum.trim()

      const __RegulaCodicemPurum = new RegExp('^' + RegulaCodicemPurum + '$', 'u')
      if (__RegulaCodicemPurum.test(textum)) {
        resultatum.push(`RegulaCodicemPurum ${quod_significationem_in_digitum(textum.match(__RegulaCodicemPurum)[0])}`)
        // resultatum.push(textum.match(RegulaCodicemPurum))
      } else {
        // resultatum.push('RegulaCodicemPurum')
      }

      const __RegulaCodicemPurumInVasum = new RegExp('^' + RegulaCodicemInVasum + '$', 'u')
      if (__RegulaCodicemPurumInVasum.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasum)
        resultatum.push(`RegulaCodicemInVasum ${quod_significationem_in_digitum(temp[2])} ${temp[1]}`)
        // resultatum.push(temp)
      } else {
        // resultatum.push('Non RegulaCodicemInVasum')
      }

      const __RegulaCodicemPurumInVasumInitiale = new RegExp('^' + RegulaCodicemInVasum + '(.+)$', 'u')
      if (__RegulaCodicemPurumInVasumInitiale.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasumInitiale)
        resultatum.push(`RegulaCodicemPurumInVasumInitiale ${quod_significationem_in_digitum(temp[2])} ${temp[1]} <<${temp[3].trim()}>>`)
        resultatum.push(temp)
      } else {
        // resultatum.push('Non RegulaCodicemPurumInVasumInitiale')
      }

      const __RegulaCodicemPurumInVasumFinale = new RegExp('^(.+)' + RegulaCodicemInVasum + '$', 'u')
      if (__RegulaCodicemPurumInVasumFinale.test(textum)) {
        let temp = textum.match(__RegulaCodicemPurumInVasumFinale)
        resultatum.push(`RegulaCodicemPurumInVasumFinale ${quod_significationem_in_digitum(temp[3])} ${temp[2]} <<${temp[1].trim()}>>`)
        resultatum.push(temp)
      } else {
        // resultatum.push('Non RegulaCodicemPurumInVasumInitiale')
      }

      // if (RegulaNumerumInitialeEtFinale.test(textum)) {
      //   resultatum.push(`RegulaNumerumInitialeEtFinale`)
      //   resultatum.push(textum.match(RegulaNumerumInitialeEtFinale))
      // } else {
      //   // resultatum.push('NonRegulaNumerumInitialeEtFinale')
      // }

      if (RegulaInitiale.test(textum)) {
        resultatum.push(`RegulaInitiale`)
        resultatum.push(textum.match(RegulaInitiale))
      } else {
        // resultatum.push('NonRegulaInitiale')
      }

      if (RegulaFinale.test(textum)) {
        resultatum.push(`RegulaFinale`)
        resultatum.push(textum.match(RegulaFinale))
      } else {
        // resultatum.push('NonRegulaFinale')
      }

      if (RegulaSystemaScribo.test(textum)) {
        resultatum.push(`RegulaSystemaScribo ${textum.replace(/\P{General_Category=Letter}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaSystemaScribo')
      }

      if (RegulaNumerum.test(textum)) {
        resultatum.push(`RegulaNumerum ${textum.replace(/\P{General_Category=Number}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaNumerum')
      }

      if (RegulaNumerumDigitum.test(textum)) {
        resultatum.push(`RegulaNumerumDigitum ${textum.replace(/\P{General_Category=Decimal_Number}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaNumerumDigitum')
      }

      if (RegulaPunctumInitiale.test(textum)) {
        resultatum.push(`RegulaPunctumInitiale ${textum.replace(/\P{General_Category=Open_Punctuation}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaPunctumInitiale')
      }

      if (RegulaPunctumFinale.test(textum)) {
        resultatum.push(`RegulaPunctumFinale ${textum.replace(/\P{General_Category=Close_Punctuation}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaPunctumFinale')
      }

      if (RegulaSublineam.test(textum)) {
        resultatum.push(`RegulaSublineam ${textum.replace(/\P{General_Category=Connector_Punctuation}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaSublineam')
      }
      if (RegulaHuphen.test(textum)) {
        resultatum.push(`RegulaHuphen ${textum.replace(/\P{General_Category=Dash_Punctuation}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaHuphen')
      }

      if (RegulaExtrapunctum.test(textum)) {
        resultatum.push(`RegulaExtrapunctum ${textum.replace(/\P{General_Category=Other_Punctuation}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaExtrapunctum')
      }

      if (RegulaSymbolum.test(textum)) {
        resultatum.push(`RegulaSymbolum ${textum.replace(/\P{General_Category=Symbol}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaSymbolum')
      }

      if (RegulaMathematicam.test(textum)) {
        resultatum.push(`RegulaMathematicam ${textum.replace(/\P{General_Category=Math_Symbol}/gu, '')}`)
      } else {
        // resultatum.push('NonRegulaMathematicam')
      }

      return resultatum
    }

    // @TODO deal with order of apperance https://stackoverflow.com/questions/44274518/how-can-i-control-within-level-node-order-in-graphvizs-dot
    function scientia_basi_in_ast_dot_numerum(scientia) {
      // let resultatum = '# TODO'

      scientia_datum = scientia.quod_completum()

      let dot = new Graphviz('ontologia-numerae')

      // console.log(scientia, scientia)

      if (scientia_datum && Object.keys(scientia_datum).length !== 0) {
        let _opt = Object.keys(scientia_datum)
        for (let [codicem_basim, signifo] of Object.entries(scientia_datum)) {
          // dot.addNode(codicem_basim)
          dot.addNode(codicem_basim, { rank: __codicem_rank(codicem_basim) })
        }

        _opt.forEach(item => {
          let __rels = __direct_children(item, _opt)
          if (__rels && __rels.length > 0) {
            dot.addRelIndirect(item, __rels)
          }
        })

      } {
        // dot.addAnnotation('vacuum?')
      }

      return dot.render()
    }

    function scientia_basi_in_ast_dot_verbosum(scientia) {
      let dot = new Graphviz('ontologia-verbosum', 'strict graph', {
        'node': { 'style': 'filled' }
      })

      scientia_datum = scientia.quod_completum()

      // console.log('scientia_datum', scientia_datum)

      // console.log(scientia, scientia)
      // node [style=filled]

      if (scientia_datum && Object.keys(scientia_datum).length !== 0) {
        let _opt = Object.keys(scientia_datum)
        for (let [codicem_basim, signifo] of Object.entries(scientia_datum)) {
          // dot.addNode(codicem_basim)
          // console.log(signifo)
          dot.addNode(codicem_basim, {
            'rank': __codicem_rank(codicem_basim),
            'verbose': __linearize(signifo)
          })
        }

        _opt.forEach(item => {
          let __rels = __direct_children(item, _opt)
          if (__rels && __rels.length > 0) {
            dot.addRelIndirect(item, __rels)
          }
        })

      } {
        // dot.addAnnotation('vacuum?')
      }

      return dot.render()
    }


    function __direct_children(code, all_options) {
      let resultatum = []
      let code_level = code.split('.').length
      // console.log('code', code)
      if (all_options) {
        all_options.forEach(item => {
          // console.log('item', item)
          if (item.indexOf(`${code}`) > -1) {
            let option_level = item.split('.').length
            // console.log('oi  code, code_level, item, option_level', code, code_level, item, option_level)
            // console.log(code_level, option_level, code_level === (option_level + 1))
            if (code_level === (option_level - 1)) {
              resultatum.push(item)
            }
          }
        });
      }
      return resultatum
    }

    function __codicem_rank(codicem_purum) {
      if (codicem_purum) {
        return codicem_purum.split('.').length
      }
      return -1
    }

    /**
     * Flat a deep object into single line array with keys and arrays
     **/
    function __linearize(obiectum) {
      let resultatum = []

      const getEntries = (o, prefix = '') =>
        Object.entries(o).flatMap(([k, v]) =>
          Object(v) === v ? getEntries(v, `${prefix}${k}.`) : [[`${prefix}${k}`, v]]
        )

      // return Object.fromEntries(getEntries(obiectum))
      Object.entries(Object.fromEntries(getEntries(obiectum))).forEach(pair => {

        resultatum.push(`${pair[0]}::${pair[1]}`)
      });

      return resultatum
    }

    /**
     * @deprecated use quod_significationem_de_caput_item()
     **/
    const quod_codicem = (textum) => {
      // @see https://stackoverflow.com/questions/14891129
      //      /regular-expression-pl-and-pn/14891168
      // let removedText = textum.replace(/\D+/g, '');
      let coniunctum = 0
      let codicem_completum = null
      let codicem_cor = textum.replace(/[^0-9_~\.\^\-\[\]\(\)\{\}]/g, '');
      if (codicem_cor.match(/\((.*)\)/)) {
        codicem_cor = codicem_cor.match(/\((.*)\)/).pop()
      }
      if (codicem_cor.match(/\[(.*)\]/)) {
        codicem_cor = codicem_cor.match(/\[(.*)\]/).pop()
      }
      if (codicem_cor.indexOf("~") > -1) {
        let temp = codicem_cor.split("~")
        codicem_cor = temp[0]
        entitatem = parseInt(temp[1])
      } else {
        codicem_completum = codicem_cor
      }

      // @TODO alternative-name--12-34
      // @TODO altrrnative-nane_12-34

      // console.log(textum_cor, textum)
      // @TODO: textum without code parts

      return [codicem_completum, codicem_cor, coniunctum, textum]
    }

    const quod_conceptum = (datum, codicem) => {
      if (datum[codicem]) {
        return datum[codicem]
      }
      return null
    }

    const quod_terminum = (conceptum, objectivum_linguam, agendum_linguam) => {
      // console.log(objectivum_linguam, conceptum[objectivum_linguam])
      if (conceptum[objectivum_linguam] && conceptum[objectivum_linguam]['0']) {
        return conceptum[objectivum_linguam]['0']
      }
      if (agendum_linguam) {
        agendum_linguam.forEach(item => {
          if (conceptum[item] && conceptum[item]['0']) {
            return conceptum[item]['0']
          }
        });
      }
      return null
    }

    const quod_resumens = (fontem, ast_rem) => {
      let resultatum = {
        fontem: fontem,
        objectivum: []
      }
      ast_rem.forEach(item => {
        resultatum.objectivum.push(item.est_textum)
      });

      return resultatum
    }

    /**
     * _[eng-Latn] Main logic [eng-Latn]_
     */
    const main = (datum, clavem_collectionem, objectivum_linguam, agendum_linguam) => {
      // console.log('main', clavem_collectionem)

      // @TODO most work on main() already is done in other parts. Eventually
      //       some clean up can start.

      let originale = clavem_collectionem.map(function (el) {
        return el.indexOf(',') > -1 ? `"${el}"` : el
      }).join(',')

      console.log(originale)

      datum_globum = datum
      let rem_titulum = clavem_collectionem.shift()
      let rem_linguam = clavem_collectionem.shift()
      let ontologia_crudum = document.querySelector('#ontologia').value
      let radicem_set = new Set()
      let grupum_set = new Set()

      jsyaml.load(ontologia_crudum, function (doc) {
        // console.log('doc', doc)
        datum = doc
      });
      // _[eng-Latn] If you and use JSON, no YAML: [eng-Latn]_
      // datum = JSON.parse(ontologia_crudum)

      // datum = JSON.parse(document.querySelector('#ontologia').value)
      // testum = JSON.parse(document.querySelector('#testum').value)

      const ast = {
        ast: {
          dot: null
        },
        summarium: {
          titulum: rem_titulum,
          linguam: rem_linguam,
          // Lingua Latina: grupum; Anglicum: cluster
          grupum: [],
          radicem: []
        },
        // ast_rem: null,
        resumens: null
      }
      const resultatum = []
      let index = 0
      clavem_collectionem.forEach(item => {
        let est_codicem = null
        let est_codicem_basim = null
        let est_codicem_completum = null
        let est_codicem_grupum = 0
        let est_conceptum = null
        let est_terminum = null
        let est_textum = null
        let est_radicem = -1
        let est_grupum = 0
        est_codicem = quod_codicem(item)
        // console.log('est_codicem', est_codicem)
        if (est_codicem && est_codicem[0]) {
          est_codicem_basim = est_codicem[0]
          est_radicem = parseInt(est_codicem[0].split('.')[0])
          est_codicem_completum = est_codicem[1]
          est_codicem_grupum = est_codicem[2]
          est_conceptum = quod_conceptum(datum, est_codicem_basim)
        }
        if (est_conceptum) {
          est_terminum = quod_terminum(est_conceptum, objectivum_linguam, agendum_linguam)
        }
        if (est_terminum) {
          est_textum = '[' + est_codicem_completum + '] ' + est_terminum
        } else {
          est_textum = '//?' + item + '?//'
        }

        radicem_set.add(est_radicem)
        grupum_set.add(est_grupum)

        // console.log(item, est_conceptum, est_terminum)
        resultatum.push(
          {
            'index': index,
            'crudum': item,
            'radicem': est_radicem,
            'est_codicem_completum': est_codicem_completum,
            'grupum': est_codicem_grupum,
            'est_conceptum': est_conceptum,
            'est_terminum': est_terminum,
            'est_textum': est_textum,
            // '__': est_codicem,
          }
        )
        index = index + 1
      });

      let clavem_collectionem_purum = clavem_collectionem.map(function (clavem) {
        let temp = quod_codicem(clavem)
        return temp[0] || ''
      })

      let ast_crudum = abstractum_syntaxim_arborem(clavem_collectionem)
      let ast_de_professorem = abstractum_syntaxim_arborem_de_professorem(ast_crudum)
      let ast_finale = abstractum_syntaxim_arborem_de_conscientiam(ast_crudum, scientia_basi)

      ast.summarium.grupum = Array.from(grupum_set).sort()
      ast.summarium.radicem = Array.from(radicem_set).sort()
      ast.collectionem = resultatum
      ast.resumens = quod_resumens(clavem_collectionem, ast.collectionem)
      // ast.ast.numerum = abstractum_syntaxim_arborem(clavem_collectionem_purum)
      // ast.ast.dot = ast_in_dot_numerae(ast.ast.numerum, rem_titulum + ',' + rem_linguam)
      ast.ast.finale = ast_finale
      ast.ast.dot = ast_in_dot_v2(ast_finale, rem_titulum + ',' + rem_linguam, originale)
      return ast
    }

  </script>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/codejar@3.5.0/codejar.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.js"
    integrity="sha512-4DlmQ+aBOfYTZ3uzRKCDXdyL7y8IlopnVChhXG0pRFgyvhwONVQW3JX8e5DYoXUNr3evQpLZz7S3O1XxMH4WKA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/mathematica/mathematica.min.js"
    integrity="sha512-rbukTh0nNllkRjO8PgdzZSWxeeG4msxoTnrIxt5kUnI1uayl6+sUxoItSZiC6/pQto44VJVc7HQ+WYzOesb1kw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/javascript/javascript.min.js" integrity="sha512-DJ/Flq7rxJDDhgkO49H/rmidX44jmxWot/ku3c+XXEF9XFal78KIpu7w6jEaQhK4jli1U3/yOH+Rp3cIIEYFPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/yaml/yaml.min.js"
    integrity="sha512-+aXDZ93WyextRiAZpsRuJyiAZ38ztttUyO/H3FZx4gOAOv4/k9C6Um1CvHVtaowHZ2h7kH0d+orWvdBLPVwb4g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"
    integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    /**
     * @see https://stackoverflow.com/questions/1293147/example-javascript-code-to-parse-csv-data/14991797#14991797
     **/
    function parseCSV(str) {
      var arr = [];
      var quote = false;  // 'true' means we're inside a quoted field

      // Iterate over each character, keep track of current row and column (of the returned array)
      for (var row = 0, col = 0, c = 0; c < str.length; c++) {
        var cc = str[c], nc = str[c + 1];        // Current character, next character
        arr[row] = arr[row] || [];             // Create a new row if necessary
        arr[row][col] = arr[row][col] || '';   // Create a new column (start with empty string) if necessary

        // If the current character is a quotation mark, and we're inside a
        // quoted field, and the next character is also a quotation mark,
        // add a quotation mark to the current column and skip the next character
        if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }

        // If it's just one quotation mark, begin/end quoted field
        if (cc == '"') { quote = !quote; continue; }

        // If it's a comma and we're not in a quoted field, move on to the next column
        if (cc == ',' && !quote) { ++col; continue; }

        // If it's a newline (CRLF) and we're not in a quoted field, skip the next character
        // and move on to the next row and move to column 0 of that new row
        if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }

        // If it's a newline (LF or CR) and we're not in a quoted field,
        // move on to the next row and move to column 0 of that new row
        if (cc == '\n' && !quote) { ++row; col = 0; continue; }
        if (cc == '\r' && !quote) { ++row; col = 0; continue; }

        // Otherwise, append the current character to the current column
        arr[row][col] += cc;
      }
      return arr;
    }

    /* CodeMirror rainbow CSV mode, START
    Author https://gist.github.com/rooks/6a13affb544ef8bc338b49af7d018318  */
    const DELIM = ','
    const QUOTE = '"'

    const MAX_LENGTH = 5
    const tokenRainbow = state => `string num${state.num}`
    const tokenPlain = () => 'string'

    CodeMirror.defineMode('csv', function modeCsv(opts, modeOpts) {
      let { delimiter = DELIM, rainbow = false } = modeOpts
      let token = rainbow ? tokenRainbow : tokenPlain

      function tokenMain(stream, state) {
        if (stream.sol()) {
          state.num = 0
        }

        let ch = stream.next()

        if (ch === QUOTE) {
          state.tokenize = tokenQuotes
          return token(state)
        }

        if (ch === delimiter) {
          state.num = (state.num + 1) % MAX_LENGTH
          return 'delim'
        }

        return token(state)
      }

      function tokenQuotes(stream, state) {
        let ch = stream.next()
        if (ch === QUOTE) {
          let next = stream.peek()
          // escaped quotaion mark
          if (next === QUOTE) {
            stream.next()
          }
          // end of the record
          else {
            state.tokenize = tokenMain
          }
        }

        return token(state)
      }

      return {
        startState() {
          return {
            num: 0,
            tokenize: tokenMain
          }
        },
        token(stream, state) {
          let style = state.tokenize(stream, state)
          return style
        }
      }
    })
    /* CodeMirror rainbow CSV mode, END */
  </script>

  <script>
    //********* _[eng-Latn] User interface logic, START [eng-Latn]_ **********//
    // TODO: implement any basic raibow only for testcases https://packagecontrol.io/packages/rainbow_csv

    // var myCodeMirror = CodeMirror(document.body);
    var CoreMirrorOntologia = CodeMirror.fromTextArea(document.querySelector('#ontologia'));
    var CoreMirrorTestum = CodeMirror.fromTextArea(document.querySelector('#testum'));
    var CoreMirrorTestumDot = CodeMirror.fromTextArea(document.querySelector('#testum_dot'));
    var CoreMirrorProfessorem = CodeMirror.fromTextArea(document.querySelector('#professorem'));
    var CoreMirroReversumAst = CodeMirror.fromTextArea(document.querySelector('#i_reversum_logicae_ast'));

    CoreMirrorOntologia.setOption('lineNumbers', true)
    CoreMirrorOntologia.setOption('theme', 'dracula')
    CoreMirrorOntologia.setOption('mode', 'yaml')
    CoreMirrorOntologia.setOption('lineWrapping', true)
    // CoreMirrorOntologia.setOption('direction', 'rtl')
    CoreMirrorOntologia.setOption('rtlMoveVisually', false)

    CoreMirrorProfessorem.setOption('lineNumbers', true)
    CoreMirrorProfessorem.setOption('theme', 'dracula')
    CoreMirrorProfessorem.setOption('mode', { name: 'csv', rainbow: true })
    // CoreMirrorProfessorem.setOption('lineWrapping', true)
    CoreMirrorProfessorem.setOption('rtlMoveVisually', false)
    CoreMirrorProfessorem.setOption('viewportMargin', true)

    CoreMirrorTestum.setOption('lineNumbers', true)
    CoreMirrorTestum.setOption('viewportMargin', true)
    // CoreMirrorTestum2.setOption('lineNumbers', true)
    // CoreMirrorTestum.setOption('mode', 'mathematica')
    // CoreMirrorTestum.setOption('mode', 'csv')
    CoreMirrorTestum.setOption('mode', { name: 'csv', rainbow: true })
    CoreMirrorTestum.setOption('rtlMoveVisually', false)
    CoreMirrorTestum.setOption('theme', 'dracula')

    CoreMirrorTestumDot.setOption('mode', 'text')
    CoreMirrorTestumDot.setOption('viewportMargin', true)
    CoreMirrorTestumDot.setOption('lineNumbers', true)

    CoreMirroReversumAst.setOption('mode', 'text')
    CoreMirroReversumAst.setOption('viewportMargin', true)
    CoreMirroReversumAst.setOption('lineNumbers', true)
    // CoreMirrorTestumDot.setOption('readOnly', true)
  </script>
  <script>
    const ui_actionem = document.querySelector('#actionem')
    const ui_objectivum_linguam = document.querySelector('#objectivum_linguam')
    const ui_agendum_linguam = document.querySelector('#agendum_linguam')
    const ui_testum_dot = document.querySelector('#testum_dot')
    const ui_ontologia_yml = document.querySelector('#ontologia-archivum-yml')
    const ui_ontologia_json = document.querySelector('#ontologia-archivum-json')
    const ui_ontologia_ast_dot_online = document.querySelector('#ontologia-ast-online-dot')
    const ui_ontologia_ast_dot_verbosum_online = document.querySelector('#ontologia-ast-online-dot-verbosum')
    const ui_professorem_ast_dot_verbosum_online = document.querySelector('#professorem-ast-online-dot-verbosum')
    const ui_testum_csv = document.querySelector('#testum-archivum-csv')
    const ui_testum_ast_dot = document.querySelector('#testum-ast-archivum-dot')
    const ui_testum_ast_dot_online = document.querySelector('#testum-ast-online-dot')
    const ui_reversum_logicae_actionem = document.querySelector('#i_reversum_logicae_actionem')
    let actionem_index = 1
    // const ui_testum = document.querySelector('#testum')
    let testum_collectionem = []
    // let abstractum_syntaxim_arborem = null
    // let scientia_basi = null
    // let scientia = null

    // Load usum-professori.csv
    let usum_professori = 'usum-professori.csv'
    fetch(usum_professori).then(function (response) {
      response.text().then(function (text) {
        CoreMirrorProfessorem.setValue(text)
      });
    });
    let usum_exemplis = 'usum-exemplis.csv'
    fetch(usum_exemplis).then(function (response) {
      response.text().then(function (text) {
        CoreMirrorTestum.setValue(text)
      });
    });
    let ontologia_referens = 'ontologia.yml'
    fetch(ontologia_referens).then(function (response) {
      response.text().then(function (text) {
        CoreMirrorOntologia.setValue(text)
      });
    });

    function prepare_scientia() {
      try {
        // const doc = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');

        scientia = new CodexDeObiectum(scientia_basi)
        scientia.estLinguamObjectivae(document.querySelector('#objectivum_linguam').value.split(','))
        scientia.estLinguamAuxilio(document.querySelector('#auxilium_linguam').value.split(','))
        scientia.estLinguamAgendae(document.querySelector('#agendum_linguam').value.split(','))
        scientia.praeparare()
        // console.log(scientia_basi);
      } catch (e) {
        console.log(e);
      }
    }
    function prepare_usum_professori() {
      try {
        usum_professori_tabulam = parseCSV(CoreMirrorProfessorem.getValue())
        let _usum_professori_obiectum = codex_de_tabulam_in_obiectum(usum_professori_tabulam)
        usum_professori_obiectum = new CodexDeObiectum(_usum_professori_obiectum)
        usum_professori_obiectum.estLinguamObjectivae(document.querySelector('#objectivum_linguam').value.split(','))
        usum_professori_obiectum.estLinguamAuxilio(document.querySelector('#auxilium_linguam').value.split(','))
        usum_professori_obiectum.estLinguamAgendae(document.querySelector('#agendum_linguam').value.split(','))
        // scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        // scientia_datum_reconstructum = scientia_basi_de_crudum(usum_professori_obiectum)
        console.log('usum_professori_obiectum', usum_professori_obiectum)
        usum_professori_obiectum.praeparare()

        console.log('usum_professori_obiectum', usum_professori_obiectum)
        // console.log('scientia_datum_reconstructum', scientia_datum_reconstructum)
      } catch (e) {
        console.log(e)
        alert(e);
      }
    }

    actionem.addEventListener("click", function (el) {
      // console.log('click', el)
      // console.log('ui_testum', ui_testum, parseCSV(ui_testum.value))
      console.group(`āctiōnem ${actionem_index}`);

      // testum_collectionem = parseCSV(ui_testum.value)
      // testum_colloctionem = parseCSV(document.querySelector('#testum').value)
      testum_collectionem = parseCSV(CoreMirrorTestum.getValue())
      adhoc_objectivum_linguam = ui_objectivum_linguam.value
      adhoc_agendum_linguam = ui_objectivum_linguam.value.split(',')

      // jsyaml.load(CoreMirrorOntologia.getValue(), function (doc) {
      //   console.log('oi')
      //   scientia_basi = doc
      // });
      try {
        // const doc = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        // console.log(scientia_basi);
      } catch (e) {
        console.log(e);
      }
      let testum_index = 1
      testum_collectionem.forEach(item => {
        console.group(`Testum ${testum_index}`);
        // console.log('loop', item)

        resultatum_main = main(scientia_basi, item, adhoc_objectivum_linguam, adhoc_agendum_linguam)
        // console.log(abstractum_syntaxim_arborem)
        // console.log(abstractum_syntaxim_arborem)
        console.log(resultatum_main.resumens.fontem)
        console.log(resultatum_main.resumens.objectivum)
        console.log(resultatum_main)
        CoreMirrorTestumDot.setValue(resultatum_main.ast.dot)

        // CoreMirrorTestumDot.setValue(ast_in_dot_numerae(abstractum_syntaxim_arborem(['12.10.34', '12.10.34~2', '', '14.56', '14.56', '14.56~2']), 'ast'))

        console.groupEnd(`Testum ${testum_index}`);
        testum_index = testum_index + 1
      });
      console.groupEnd(`āctiōnem ${actionem_index}`);
      actionem_index = actionem_index + 1
    });

    // Uses https://github.com/eligrey/FileSaver.js
    ui_ontologia_yml.addEventListener("click", function (el) {
      var blob = new Blob([CoreMirrorOntologia.getValue()], { type: "text/x-yaml;charset=utf-8" });
      saveAs(blob, "ontologia.yml");
    });

    ui_ontologia_json.addEventListener("click", function (el) {
      try {
        scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
      } catch (e) {
        console.log(e)
        alert(e);
      }
      var blob = new Blob([JSON.stringify(scientia_basi, null, 2)], { type: "application/jsonl;charset=utf-8" });
      saveAs(blob, "ontologia.json");
    });

    ui_ontologia_ast_dot_online.addEventListener("click", function (el) {
      prepare_scientia()
      // console.log('scientia', scientia)
      let scientia_numerum_dot = scientia_basi_in_ast_dot_numerum(scientia)
      this.href = 'https://edotor.net/?engine=dot#' + encodeURI(scientia_numerum_dot)
      return false;
    });

    ui_ontologia_ast_dot_verbosum_online.addEventListener("click", function (el) {
      prepare_scientia()
      // console.log('scientia', scientia)
      let scientia_numerum_dot = scientia_basi_in_ast_dot_verbosum(scientia)
      this.href = 'https://edotor.net/?engine=dot#' + encodeURI(scientia_numerum_dot)
      return false;
    });

    ui_professorem_ast_dot_verbosum_online.addEventListener("click", function (el) {
      // prepare_scientia()
      prepare_usum_professori()
      // console.log('scientia', scientia)
      // let usum_professori_dot = scientia_basi_in_ast_dot_verbosum(scientia_datum_reconstructum)
      let usum_professori_dot = scientia_basi_in_ast_dot_verbosum(usum_professori_obiectum)
      this.href = 'https://edotor.net/?engine=dot#' + encodeURI(usum_professori_dot)
      return false;
    });

    ui_testum_csv.addEventListener("click", function (el) {
      var blob = new Blob([CoreMirrorTestum.getValue()], { type: "text/csv;charset=utf-8" });
      saveAs(blob, "testum.csv");
    });

    ui_testum_ast_dot.addEventListener("click", function (el) {
      var blob = new Blob([CoreMirrorTestumDot.getValue()], { type: "vnd.graphviz;charset=utf-8" });
      saveAs(blob, "testum-ast.gv");
    });

    ui_testum_ast_dot_online.addEventListener("click", function (el) {
      // this.href = 'https://dreampuf.github.io/GraphvizOnline/#' + encodeURI(CoreMirrorTestumDot.getValue())
      this.href = 'https://edotor.net/?engine=dot#' + encodeURI(CoreMirrorTestumDot.getValue())
      // console.log('oi', el, this)

      // var blob = new Blob([CoreMirrorTestumDot.getValue()], { type: "vnd.graphviz;charset=utf-8" });
      // saveAs(blob, "testum-ast.gv");
      return false;
    });

    ui_reversum_logicae_actionem.addEventListener("click", function (el) {
      const ui_reversum_logicae = document.querySelector('#i_reversum_logicae')
      const ui_reversum_logicae_strictum = document.querySelector('#i_reversum_logicae_strictum')
      // alert('oi', ui_reversum_logicae.value)

      scientia_basi = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
      scientia = new CodexDeObiectum(scientia_basi)
      scientia.estLinguamObjectivae(document.querySelector('#objectivum_linguam').value.split(','))
      scientia.estLinguamAuxilio(document.querySelector('#auxilium_linguam').value.split(','))
      scientia.estLinguamAgendae(document.querySelector('#agendum_linguam').value.split(','))
      scientia.praeparare()
      scientia.quod_terminum('12')
      let __result = scientia.reversumLogicae(document.querySelector('#i_reversum_logicae').value)

      // console.log(ui_reversum_logicae, ui_reversum_logicae.value)
      CoreMirroReversumAst.setValue('# @TODO ' + JSON.stringify(__result))
      // return false;
    });


    //*********** _[eng-Latn] User interface logic, END [eng-Latn]_ **********//
  </script>
  <!-- https://stackoverflow.com/questions/35454245/how-to-mix-rtl-and-ltr-text-directions-in-the-same-option-element/35491589#35491589
  <textarea dir="RTL" style="width: 100%; height: 5em; unicode-bidi: embed">
Testum/4,prs-Arab-x-testum,"//نام مهاجم// [12.10.34~1]","//نام بازمانده// [12.10.34~2]""لورم اپیسوم","//نام شرکت// [14.56~2]","لورم اپیسوم"</textarea> -->
</body>

</html>
