<!--
Dominium Publicum
SPDX-License-Identifier: Unlicense
-->
<!doctype html>
<html lang="la">
<head>
  <meta charset="utf-8">
  <title>cōdex simplex ontologiae</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css" integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.css" integrity="sha512-CCnciBUnVXwa6IQT9q8EmGcarNit9GdKI5nJnj56B1iu0LuD13Qn/GZ+IUkrZROZaBdutN718NK6mIXdUjZGqg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css" integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<!--
  @see
  - https://github.com/HXL-CPLP/forum/issues/60
  - https://github.com/SEMICeu/Core-Person-Vocabulary/issues/39

-->

<body>
  <p>cōdex simplex ontologiae Ad console.log</p>
  <textarea id="ontologia" style="width:100%;min-height: 20em;">
{
  "12": {
    "eng-Latn": {
      "0": "Person"
    },
    "prs-Arab": {
      "0": "//شخص//"
    },
    "qhx-Latn": {
      "0": "#item+personam"
    }
  },
  "12.10": {
    "eng-Latn": {
      "0": "Person - //Any type of person name//"
    },
    "prs-Arab": {
      "0": "//شخص// - //هر نوع نام شخصی//"
    },
    "qhx-Latn": {
      "0": "#item+personam+nomen+co_12_10"
    }
  },
  "12.10.34": {
    "eng-Latn": {
      "0": "Person - alternative name"
    },
    "prs-Arab": {
      "0": "//شخص// - //نام جایگزین//"
    },
    "qhx-Latn": {
      "0": "#item+personam+nomen+co_12_10_34"
    }
  },
  "12.10.34.5.99": {
    "eng-Latn": {
      "0": "Person - nickname from workplace"
    },
    "prs-Arab": {
      "0": "//شخص// - //نام مستعار از محل کار//"
    }
  },
  "14": {
    "eng-Latn": {
      "0": "Legal Entity"
    },
    "prs-Arab": {
      "0": "//نهاد قانونی//"
    }
  },
  "14.56": {
    "eng-Latn": {
      "0": "Legal Entity - alternative name"
    },
    "prs-Arab": {
      "0": "//نهاد قانونی// - //نام جایگزین//"
    }
  }
}
  </textarea>
  <textarea id="testum" style="width:100%;min-height: 5em;">
{
  "1": [
    '12.10.34',
    '12.10.34~2',
    '14.56',
    '14.56~2'
  ],
  "2": [
    'Attacker name [12.10.34~1]',
    'Survivor name [12.10.34~2]',
    'Company name [14.56~2]'
  ],
  "3": [
    'alternative-name--12-34',
    'altrrnative-nane_12-34',
    'lawyer_12-34'
  ],
  "4": [
    '//نام مهاجم// [12.10.34~1]',
    '//نام بازمانده// [12.10.34~2]',
    '//نام شرکت// [14.56~2]'
  ]
}
  </textarea>

  <script>
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/
    const debug = false
    let datum = {}
    let testum = {}

    testum = {
      "1": [
        '12.10.34',
        '12.10.34~2',
        '14.56',
        '14.56~2',
      ],
      "2": [
        'Attacker name [12.10.34~1]',
        'Survivor name [12.10.34~2]',
        'Company name [14.56~2]'
      ],
      "3": [
        'alternative-name--12-34',
        'altrrnative-nane_12-34',
        'lawyer_12-34'
      ],
      "4": [
        '//نام مهاجم// [12.10.34~1]',
        '//نام بازمانده// [12.10.34~2]',
        '//نام شرکت// [14.56~2]'
      ]
    }
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/

    // @TODO: too simplistic. Need deal with more cases
    const quod_codicem = (textum) => {
      // @see https://stackoverflow.com/questions/14891129
      //      /regular-expression-pl-and-pn/14891168
      // let removedText = textum.replace(/\D+/g, '');
      let entitatem = 0
      let codicem_completum = null
      let codicem_cor = textum.replace(/[^0-9_~\.\^\-\[\]\(\)\{\}]/g, '');
      if (codicem_cor.match(/\((.*)\)/)) {
        codicem_cor = codicem_cor.match(/\((.*)\)/).pop()
      }
      if (codicem_cor.match(/\[(.*)\]/)) {
        codicem_cor = codicem_cor.match(/\[(.*)\]/).pop()
      }
      if (codicem_cor.indexOf("~") > -1) {
        let temp = codicem_cor.split("~")
        codicem_completum = temp[0]
        entitatem = parseInt(temp[1])
      } else {
        codicem_completum = codicem_cor
      }

      // @TODO alternative-name--12-34
      // @TODO altrrnative-nane_12-34

      // console.log(textum_cor, textum)
      // @TODO: textum without code parts

      return [codicem_completum, codicem_cor, entitatem, textum]
    }

    const quod_conceptum = (datum, codicem) => {
      if (datum[codicem]) {
        return datum[codicem]
      }
      return null
    }

    const quod_terminum = (conceptum, objectivum_linguam, agendum_linguam) => {
      // console.log(objectivum_linguam, conceptum[objectivum_linguam])
      if (conceptum[objectivum_linguam] && conceptum[objectivum_linguam]['0']) {
        return conceptum[objectivum_linguam]['0']
      }
      if (agendum_linguam) {
        agendum_linguam.forEach(item => {
          if (conceptum[item] && conceptum[item]['0']) {
            return conceptum[item]['0']
          }
        });
      }
      return null
    }

    const quod_resumens = (fontem, ast_rem) => {
      let resultatum = {
        fontem: fontem,
        objectivum: []
      }
      ast_rem.forEach(item => {
        resultatum.objectivum.push(item.est_textum)
      });

      return resultatum
    }

    const main = (clavem_collectionem, objectivum_linguam, agendum_linguam) => {
      datum = JSON.parse(document.querySelector('#ontologia').value)
      // testum = JSON.parse(document.querySelector('#testum').value)

      const ast = {
        ast_completum: null,
        ast_rem: null,
        resumens: null
      }
      const resultatum = []
      let index = 0
      clavem_collectionem.forEach(item => {
        let est_codicem = null
        let est_codicem_basim = null
        let est_codicem_completum = null
        let est_conceptum = null
        let est_terminum = null
        let est_textum = null
        est_codicem = quod_codicem(item)
        // console.log('est_codicem', est_codicem)
        if (est_codicem) {
          est_codicem_basim = est_codicem[0]
          est_codicem_completum = est_codicem[1]
          est_conceptum = quod_conceptum(datum, est_codicem_basim)
        }
        if (est_conceptum) {
          est_terminum = quod_terminum(est_conceptum, objectivum_linguam, agendum_linguam)
        }
        if (est_terminum) {
          est_textum = '[' + est_codicem_completum + '] ' + est_terminum
        } else {
          est_textum = '//?' + item + '?//'
        }

        // console.log(item, est_conceptum, est_terminum)
        resultatum.push(
          {
            'index': index,
            'crudum': item,
            'est_codicem_completum': est_codicem_completum,
            'est_conceptum': est_conceptum,
            'est_terminum': est_terminum,
            'est_textum': est_textum,
          }
        )
        index = index + 1
      });
      ast.ast_rem = resultatum
      ast.resumens = quod_resumens(clavem_collectionem, ast.ast_rem)
      return ast
    }

    // console.log(datum)
    // console.log(testum)

    let ad_hoc_rem = null
    console.log(1)
    ad_hoc_rem = main(testum["1"], 'eng-Latn', ['prs-Arab'])
    console.log(ad_hoc_rem.resumens.fontem)
    console.log(ad_hoc_rem.resumens.objectivum)
    console.log(ad_hoc_rem)

    console.log("1 'qhx-Latn")
    ad_hoc_rem = main(testum["1"], 'qhx-Latn', ['prs-Arab', 'eng-Latn'])
    console.log(ad_hoc_rem.resumens.fontem)
    console.log(ad_hoc_rem.resumens.objectivum)
    console.log(ad_hoc_rem)

    console.log(2)
    ad_hoc_rem = main(testum["2"], 'eng-Latn', ['prs-Arab'])
    console.log(ad_hoc_rem.resumens.fontem)
    console.log(ad_hoc_rem.resumens.objectivum)
    console.log(ad_hoc_rem)

    console.log(3)
    ad_hoc_rem = main(testum["3"], 'eng-Latn', ['prs-Arab'])
    console.log(ad_hoc_rem.resumens.fontem)
    console.log(ad_hoc_rem.resumens.objectivum)
    console.log(ad_hoc_rem)

    console.log(4)
    ad_hoc_rem = main(testum["4"], 'eng-Latn', ['prs-Arab'])
    console.log(ad_hoc_rem.resumens.fontem)
    console.log(ad_hoc_rem.resumens.objectivum)
    console.log(ad_hoc_rem)
    // main(testum["2"], 'eng-Latn')
  </script>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/codejar@3.5.0/codejar.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.js" integrity="sha512-4DlmQ+aBOfYTZ3uzRKCDXdyL7y8IlopnVChhXG0pRFgyvhwONVQW3JX8e5DYoXUNr3evQpLZz7S3O1XxMH4WKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/javascript/javascript.min.js" integrity="sha512-DJ/Flq7rxJDDhgkO49H/rmidX44jmxWot/ku3c+XXEF9XFal78KIpu7w6jEaQhK4jli1U3/yOH+Rp3cIIEYFPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <textarea id="editor">asd asd asd asd asd</textarea>
  <!-- <script src="lib/codemirror.js"></script> -->
  <!-- <link rel="stylesheet" href="lib/codemirror.css"> -->
  <!-- <script src="mode/javascript/javascript.js"></script> -->
  <!-- https://codemirror.net/doc/manual.html -->
  <script>
    // var myCodeMirror = CodeMirror(document.body);
    var CoreMirrorOntologia = CodeMirror.fromTextArea(document.querySelector('#ontologia'));
    var CoreMirrorTestum = CodeMirror.fromTextArea(document.querySelector('#testum'));

    CoreMirrorOntologia.setOption('lineNumbers', true)
    CoreMirrorTestum.setOption('lineNumbers', true)
  </script>

</body>

</html>
