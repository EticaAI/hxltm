<!--
Dominium Publicum
SPDX-License-Identifier: Unlicense
-->
<!doctype html>
<html lang="la">

<head>
  <meta charset="utf-8">
  <title>cōdex simplex ontologiae</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css" integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.css"
    integrity="sha512-CCnciBUnVXwa6IQT9q8EmGcarNit9GdKI5nJnj56B1iu0LuD13Qn/GZ+IUkrZROZaBdutN718NK6mIXdUjZGqg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/theme/dracula.min.css"
    integrity="sha512-gFMl3u9d0xt3WR8ZeW05MWm3yZ+ZfgsBVXLSOiFz2xeVrZ8Neg0+V1kkRIo9LikyA/T9HuS91kDfc2XWse0K0A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<!--
  @see
  - https://github.com/HXL-CPLP/forum/issues/60
  - https://github.com/SEMICeu/Core-Person-Vocabulary/issues/39

-->

<body>
  <h1>cōdex simplex ontologiae</h1>
  <div class="fixed-bottom">
    <form>
      <input type="text" id="objectivum_linguam" placeholder="objectivum_linguam" value="eng-Latn" />
      <input type="text" id="agendum_linguam" placeholder="agendum_linguam" value="prs-Arab,qhx-Latn">
      <button type="button" class="btn btn-primary" id="actionem" class="actionem">āctiōnem</button>
    </form>
  </div>
  <p>cōdex simplex ontologiae Ad console.log</p>
  <h2>Ontologia</h2>
  <textarea id="ontologia" style="width:100%;min-height: 10em;">
# https://semiceu.github.io/Core-Person-Vocabulary/releases/2.00/
'12':
  eng-Latn:
    '0': Person
  prs-Arab:
    '0': "//شخص//"
  qhx-Latn:
    '0': "#item+personam"
'14':
  eng-Latn:
    '0': Legal Entity
  prs-Arab:
    '0': "//نهاد قانونی//"
'12.10':
  eng-Latn:
    '0': Person - //Any type of person name//
  prs-Arab:
    '0': "//شخص// - //هر نوع نام شخصی//"
  qhx-Latn:
    '0': "#item+personam+nomen+co_12_10"
'12.10.34':
  eng-Latn:
    '0': Person - alternative name
  prs-Arab:
    '0': "//شخص// - //نام جایگزین//"
  qhx-Latn:
    '0': "#item+personam+nomen+co_12_10_34"
'12.10.34.5.99':
  eng-Latn:
    '0': Person - nickname from workplace
  prs-Arab:
    '0': "//شخص// - //نام مستعار از محل کار//"
'14.56':
  eng-Latn:
    '0': Legal Entity - alternative name
  prs-Arab:
    '0': "//نهاد قانونی// - //نام جایگزین//"
  </textarea>
  <!--
  <h2>Professōrem</h2>
  <textarea id="professorem" style="width:100%;height: auto;">
UNMigration/HTCDS,eng-Latn-x-exemplum,Case Owner,[12.10.23] First Name,[12.10.45] Second Name,Type of Exploitation
INTERPOL/ante-mortem,eng-Latn-x-exemplum,AM No:,[12.10.23] First name(s):,[12.10.23] Family name:,Date of birth:,Nature of disaster:
  </textarea>
-->
  <h2>Testum</h2>
  <textarea id="testum">
Testum/1,mul-Zmth-x-testum,12.10.34,12.10.34~2,14.56,14.56,14.56~2
Testum/2,mul-Latn-x-testum,Attacker name [12.10.34~1],Survivor name [12.10.34~2],Company name [14.56~2]
Testum/3,mul-Latn-x-testum,alternative-name--12-10-34,altrrnative-nane_12-10-34
Testum/4,prs-Arab-x-testum,"//نام مهاجم// [12.10.34~1]","//نام بازمانده// [12.10.34~2]","//نام شرکت// [14.56~2]"
Testum/555,mul-Zmth-x-testum,12.10.34,12.10.34~2,14.56,14.56,14.56~2
</textarea>
  <h3>DOT</h3>
  <textarea id="testum_dot" style="width:100%; min-height: 5em; height: auto;"></textarea>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"
    integrity="sha512-CSBhVREyzHAjAFfBlIBakjoRUKp5h7VSweP0InR/pAJyptH7peuhCsqAI/snV+TwZmXZqoUklpXp6R6wMnYf5Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/
    const debug = false
    let datum_globum = {}
    let testum = {}
    /****** _[eng-Latn] Edit this section [eng-Latn]_ ******/
    // const yaml = require('js-yaml');

    // @TODO: too simplistic. Need deal with more cases
    const quod_codicem = (textum) => {
      // @see https://stackoverflow.com/questions/14891129
      //      /regular-expression-pl-and-pn/14891168
      // let removedText = textum.replace(/\D+/g, '');
      let entitatem = 0
      let codicem_completum = null
      let codicem_cor = textum.replace(/[^0-9_~\.\^\-\[\]\(\)\{\}]/g, '');
      if (codicem_cor.match(/\((.*)\)/)) {
        codicem_cor = codicem_cor.match(/\((.*)\)/).pop()
      }
      if (codicem_cor.match(/\[(.*)\]/)) {
        codicem_cor = codicem_cor.match(/\[(.*)\]/).pop()
      }
      if (codicem_cor.indexOf("~") > -1) {
        let temp = codicem_cor.split("~")
        codicem_completum = temp[0]
        entitatem = parseInt(temp[1])
      } else {
        codicem_completum = codicem_cor
      }

      // @TODO alternative-name--12-34
      // @TODO altrrnative-nane_12-34

      // console.log(textum_cor, textum)
      // @TODO: textum without code parts

      return [codicem_completum, codicem_cor, entitatem, textum]
    }

    const quod_conceptum = (datum, codicem) => {
      if (datum[codicem]) {
        return datum[codicem]
      }
      return null
    }

    const quod_terminum = (conceptum, objectivum_linguam, agendum_linguam) => {
      // console.log(objectivum_linguam, conceptum[objectivum_linguam])
      if (conceptum[objectivum_linguam] && conceptum[objectivum_linguam]['0']) {
        return conceptum[objectivum_linguam]['0']
      }
      if (agendum_linguam) {
        agendum_linguam.forEach(item => {
          if (conceptum[item] && conceptum[item]['0']) {
            return conceptum[item]['0']
          }
        });
      }
      return null
    }

    const quod_resumens = (fontem, ast_rem) => {
      let resultatum = {
        fontem: fontem,
        objectivum: []
      }
      ast_rem.forEach(item => {
        resultatum.objectivum.push(item.est_textum)
      });

      return resultatum
    }

    const de_codex_ast_in_dot = (ast) => {
      let titulum = ast.ast_completum.titulum + ',' + ast.ast_completum.linguam
      return `digraph "${titulum}" {
  A -> {B C}
}`
    }

    /**
     * _[eng-Latn] Main logic [eng-Latn]_
     */
    const main = (datum, clavem_collectionem, objectivum_linguam, agendum_linguam) => {
      // console.log('main', clavem_collectionem)
      datum_globum = datum
      let rem_titulum = clavem_collectionem.shift()
      let rem_linguam = clavem_collectionem.shift()
      let ontologia_crudum = document.querySelector('#ontologia').value

      jsyaml.load(ontologia_crudum, function (doc) {
        console.log('doc', doc)
        datum = doc
      });
      // _[eng-Latn] If you and use JSON, no YAML: [eng-Latn]_
      // datum = JSON.parse(ontologia_crudum)

      // datum = JSON.parse(document.querySelector('#ontologia').value)
      // testum = JSON.parse(document.querySelector('#testum').value)

      const ast = {
        ast_completum: {
          titulum: rem_titulum,
          linguam: rem_linguam,
          entitatem: []
        },
        ast_rem: null,
        resumens: null
      }
      const resultatum = []
      let index = 0
      clavem_collectionem.forEach(item => {
        let est_codicem = null
        let est_codicem_basim = null
        let est_codicem_completum = null
        let est_conceptum = null
        let est_terminum = null
        let est_textum = null
        let est_codicem_entitatem = -1
        est_codicem = quod_codicem(item)
        // console.log('est_codicem', est_codicem)
        if (est_codicem) {
          est_codicem_basim = est_codicem[0]
          est_codicem_completum = est_codicem[1]
          est_codicem_entitatem = est_codicem[2]
          est_conceptum = quod_conceptum(datum, est_codicem_basim)
        }
        if (est_conceptum) {
          est_terminum = quod_terminum(est_conceptum, objectivum_linguam, agendum_linguam)
        }
        if (est_terminum) {
          est_textum = '[' + est_codicem_completum + '] ' + est_terminum
        } else {
          est_textum = '//?' + item + '?//'
        }

        // console.log(item, est_conceptum, est_terminum)
        resultatum.push(
          {
            'index': index,
            'crudum': item,
            'est_codicem_completum': est_codicem_completum,
            'est_codicem_entitatem': est_codicem_entitatem,
            'est_conceptum': est_conceptum,
            'est_terminum': est_terminum,
            'est_textum': est_textum,
          }
        )
        index = index + 1
      });
      ast.ast_rem = resultatum
      ast.resumens = quod_resumens(clavem_collectionem, ast.ast_rem)
      ast.dot = de_codex_ast_in_dot(ast)
      return ast
    }

  </script>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/codejar@3.5.0/codejar.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.js"
    integrity="sha512-4DlmQ+aBOfYTZ3uzRKCDXdyL7y8IlopnVChhXG0pRFgyvhwONVQW3JX8e5DYoXUNr3evQpLZz7S3O1XxMH4WKA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/mathematica/mathematica.min.js"
    integrity="sha512-rbukTh0nNllkRjO8PgdzZSWxeeG4msxoTnrIxt5kUnI1uayl6+sUxoItSZiC6/pQto44VJVc7HQ+WYzOesb1kw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/javascript/javascript.min.js" integrity="sha512-DJ/Flq7rxJDDhgkO49H/rmidX44jmxWot/ku3c+XXEF9XFal78KIpu7w6jEaQhK4jli1U3/yOH+Rp3cIIEYFPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/mode/yaml/yaml.min.js"
    integrity="sha512-+aXDZ93WyextRiAZpsRuJyiAZ38ztttUyO/H3FZx4gOAOv4/k9C6Um1CvHVtaowHZ2h7kH0d+orWvdBLPVwb4g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    /**
     * @see https://stackoverflow.com/questions/1293147/example-javascript-code-to-parse-csv-data/14991797#14991797
     **/
    function parseCSV(str) {
      var arr = [];
      var quote = false;  // 'true' means we're inside a quoted field

      // Iterate over each character, keep track of current row and column (of the returned array)
      for (var row = 0, col = 0, c = 0; c < str.length; c++) {
        var cc = str[c], nc = str[c + 1];        // Current character, next character
        arr[row] = arr[row] || [];             // Create a new row if necessary
        arr[row][col] = arr[row][col] || '';   // Create a new column (start with empty string) if necessary

        // If the current character is a quotation mark, and we're inside a
        // quoted field, and the next character is also a quotation mark,
        // add a quotation mark to the current column and skip the next character
        if (cc == '"' && quote && nc == '"') { arr[row][col] += cc; ++c; continue; }

        // If it's just one quotation mark, begin/end quoted field
        if (cc == '"') { quote = !quote; continue; }

        // If it's a comma and we're not in a quoted field, move on to the next column
        if (cc == ',' && !quote) { ++col; continue; }

        // If it's a newline (CRLF) and we're not in a quoted field, skip the next character
        // and move on to the next row and move to column 0 of that new row
        if (cc == '\r' && nc == '\n' && !quote) { ++row; col = 0; ++c; continue; }

        // If it's a newline (LF or CR) and we're not in a quoted field,
        // move on to the next row and move to column 0 of that new row
        if (cc == '\n' && !quote) { ++row; col = 0; continue; }
        if (cc == '\r' && !quote) { ++row; col = 0; continue; }

        // Otherwise, append the current character to the current column
        arr[row][col] += cc;
      }
      return arr;
    }
  </script>

  <script>
    //********* _[eng-Latn] User interface logic, START [eng-Latn]_ **********//
    // TODO: implement any basic raibow only for testcases https://packagecontrol.io/packages/rainbow_csv

    // var myCodeMirror = CodeMirror(document.body);
    var CoreMirrorOntologia = CodeMirror.fromTextArea(document.querySelector('#ontologia'));
    var CoreMirrorTestum = CodeMirror.fromTextArea(document.querySelector('#testum'));
    // var CoreMirrorTestum2 = CodeMirror.fromTextArea(document.querySelector('#testum2'));

    CoreMirrorOntologia.setOption('lineNumbers', true)
    CoreMirrorOntologia.setOption('mode', 'yaml')
    CoreMirrorTestum.setOption('lineNumbers', true)
    // CoreMirrorTestum2.setOption('lineNumbers', true)
    // CoreMirrorTestum.setOption('mode', 'mathematica')
    CoreMirrorTestum.setOption('mode', 'text')
  </script>
  <script>
    const ui_actionem = document.querySelector('#actionem')
    const ui_objectivum_linguam = document.querySelector('#objectivum_linguam')
    const ui_agendum_linguam = document.querySelector('#agendum_linguam')
    const ui_testum_dot = document.querySelector('#testum_dot')
    // const ui_testum = document.querySelector('#testum')
    let testum_colloctionem = []
    let abstractum_syntaxim_arborem = null
    let datum_temp = null

    try {
      // const doc = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
      datum_temp = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
      console.log(datum_temp);
    } catch (e) {
      console.log(e);
    }
    actionem.addEventListener("click", function (el) {
      // console.log('click', el)
      // console.log('ui_testum', ui_testum, parseCSV(ui_testum.value))

      // testum_colloctionem = parseCSV(ui_testum.value)
      // testum_colloctionem = parseCSV(document.querySelector('#testum').value)
      testum_colloctionem = parseCSV(CoreMirrorTestum.getValue())
      adhoc_objectivum_linguam = ui_objectivum_linguam.value
      adhoc_agendum_linguam = ui_objectivum_linguam.value.split(',')

      // jsyaml.load(CoreMirrorOntologia.getValue(), function (doc) {
      //   console.log('oi')
      //   datum_temp = doc
      // });
      try {
        // const doc = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        datum_temp = jsyaml.load(CoreMirrorOntologia.getValue(), 'utf8');
        console.log(datum_temp);
      } catch (e) {
        console.log(e);
      }
      testum_colloctionem.forEach(item => {
        // console.log('loop', item)

        abstractum_syntaxim_arborem = main(datum_temp, item, adhoc_objectivum_linguam, adhoc_agendum_linguam)
        // console.log(abstractum_syntaxim_arborem)
        // console.log(abstractum_syntaxim_arborem)
        console.log(abstractum_syntaxim_arborem.resumens.fontem)
        console.log(abstractum_syntaxim_arborem.resumens.objectivum)
        console.log(abstractum_syntaxim_arborem)
        ui_testum_dot.value = abstractum_syntaxim_arborem.dot
      });
    });
    //*********** _[eng-Latn] User interface logic, END [eng-Latn]_ **********//
  </script>

  <h2>@TODO</h2>
  <p>
  <ul>
    <!-- http://www.graphviz.org/doc/info/lang.html -->
    <li>http://viz-js.com/
      <!-- http://www.graphviz.org/doc/info/lang.html -->
    </li>
    <li>https://github.com/dagrejs/dagre/wiki</li>
    <li>http://webgraphviz.com/</li>
    <!-- _[eng-Latn] this one accept show via URL [eng-Latn]_  -->
    <li>https://dreampuf.github.io/GraphvizOnline/</li>
  </ul>
  </p>
</body>

</html>
